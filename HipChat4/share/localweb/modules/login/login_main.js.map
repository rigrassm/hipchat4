{"version":3,"sources":["webpack:///webpack/bootstrap e5b4005e5e672232f369","webpack:///./src/js/native/login/login_main.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;ACrCA,EAAC,YAAW;;;;;;;;AAQV,OAAI,YAAY,SAAZ,SAAY,CAAS,QAAT,EAAmB,YAAnB,EAAiC;AAC/C,SAAI,QAAQ,MAAM,SAAN,CAAgB,KAAhB,CAAsB,IAAtB,CAA2B,SAAS,gBAAT,CAA0B,QAA1B,CAA3B,CAAR,CAD2C;AAE/C,SAAI,YAAJ,EAAkB;AAChB,eAAQ,MAAM,MAAN,CAAa,UAAS,EAAT,EAAY;AAC/B,gBAAO,GAAG,YAAH,KAAoB,IAApB,CADwB;QAAZ,CAArB,CADgB;MAAlB;AAKA,YAAO,KAAP,CAP+C;IAAjC;;;AARN,OAmBN,kBAAkB,SAAlB,eAAkB,CAAS,YAAT,EAAuB;AAC3C,YAAO,UAAU,yDAAV,EAAqE,YAArE,CAAP,CAD2C;IAAvB;;;AAnBZ,OAwBN,uBAAuB,SAAvB,oBAAuB,GAAW;AACpC,SAAI,QAAQ,gBACV;AADU,OAEV,CAFU,CAAR,CADgC;AAIpC,SAAI,KAAJ,EAAW;AACT,aAAM,KAAN,GADS;AAET,WAAI,OAAO,MAAM,MAAN,KAAiB,UAAxB,EAAoC;AACtC,eAAM,MAAN,GADsC;QAAxC;MAFF;IAJyB,CAxBjB;;AAoCV,OAAI,gBAAgB,SAAhB,aAAgB,GAAW;;AAE7B,eAAU,oBAAV,EAAgC,OAAhC,CAAwC,UAAS,KAAT,EAAgB;AACtD,aAAM,eAAN,CAAsB,UAAtB,EADsD;MAAhB,CAAxC,CAF6B;IAAX,CApCV;;AA2CV,OAAI,iBAAiB,SAAjB,cAAiB,GAAW;;AAE9B,eAAU,oBAAV,EAAgC,OAAhC,CAAwC,UAAS,KAAT,EAAgB;AACtD,aAAM,YAAN,CAAmB,UAAnB,EAA8B,UAA9B,EADsD;MAAhB,CAAxC,CAF8B;IAAX,CA3CX;;AAkDV,OAAI,aAAa,SAAb,UAAa,CAAS,GAAT,EAAc;AAC7B,eAAU,cAAV,EACE;AADF,OAEE,CAFF,EAEK,SAFL,CAEe,GAFf,CAEmB,OAFnB,EAD6B;AAI7B,eAAU,cAAV,EACE;AADF,OAEE,CAFF,EAEK,SAFL,IAEkB,6BAA6B,GAA7B,GAAmC,QAAnC,CANW;IAAd,CAlDP;;AA2DV,OAAI,cAAc,SAAd,WAAc,GAAW;AAC3B,eAAU,cAAV,EACE;AADF,OAEE,CAFF,EAEK,SAFL,CAEe,MAFf,CAEsB,OAFtB,EAD2B;AAI3B,eAAU,aAAV,EAAyB,OAAzB,CAAiC,UAAS,EAAT,EAAY;AAC3C,UAAG,MAAH,GAD2C;MAAZ,CAAjC,CAJ2B;IAAX;;;;;;;AA3DR,OA2EN,oBAAoB,EAApB,CA3EM;AA4EV,OAAI,eAAe,SAAf,YAAe,CAAS,MAAT,EAAiB;AAClC,SAAI,CAAC,MAAD,EAAS;AACX,gBAAS,iBAAT,CADW;MAAb;AAGA,yBAAoB,MAApB;;AAJkC,WAMlC,GAAS,OAAO,OAAP,CAAe,4BAAf,EAA4C,EAA5C,CAAT;;;AANkC,SAS9B,WAAW,aAAa,MAAb;;;AATmB,gBAYlC,GAZkC;AAalC,sBAbkC;AAclC,SAAI,MAAM,IAAI,cAAJ,EAAN,CAd8B;AAelC,SAAI,kBAAkB,SAAlB,eAAkB,GAAU;AAC9B,uBAD8B;AAE9B,kBAAW,sEAAX,EAF8B;MAAV,CAfY;AAmBlC,SAAI,kBAAJ,GAAyB,YAAW;AAClC,WAAI,IAAI,UAAJ,KAAmB,IAAI,IAAJ,EAAU;AAC/B,aAAI,IAAI,MAAJ,KAAe,GAAf,EAAoB;AACtB,eAAI;AACF,iBAAI,WAAW,KAAK,KAAL,CAAW,IAAI,YAAJ,CAAX,CAA6B,QAA7B;;;AADb,YAAJ,CAIE,OAAO,CAAP,EAAU;AACV,+BADU;YAAV;;;AALoB,eAUlB,kCAAkC,SAAS,gBAAT,CAVhB;AAWtB,eAAI,kCAAkC,SAAS,2BAAT;;;AAXhB,eAclB,+BAAJ,EAAqC;AACnC,oBAAO,GAAP,CAAW,iBAAX,CAA6B,QAA7B,EADmC;AAEnC,oBAAO,GAAP,CAAW,kBAAX,CAA8B,QAA9B;;;AAFmC,YAArC,MAKO,IAAI,+BAAJ,EAAqC;AAC1C,sBAAO,GAAP,CAAW,iBAAX,CAA6B,QAA7B,EAD0C;AAE1C,wBAAS,QAAT,CAAkB,IAAlB,GAAyB,WAAW,UAAX;;;AAFiB,cAArC,MAKA;AACL,mCADK;gBALA;;;AAnBe,UAAxB,MA6BO;AACL,+BADK;YA7BP;QADF;MADuB,CAnBS;AAuDlC,SAAI,IAAJ,CAAS,KAAT,EAAgB,WAAW,eAAX,EAA4B,IAA5C,EAvDkC;AAwDlC,SAAI,IAAJ,GAxDkC;IAAjB,CA5ET;;AAuIV,aAAU,cAAV,EAA0B,CAA1B,EAA6B,gBAA7B,CAA8C,QAA9C,EAAwD,UAAS,CAAT,EAAW;AACjE,OAAE,cAAF,GADiE;AAEjE,kBAAa,UAAU,eAAV,EAA2B,CAA3B,EAA8B,KAA9B,CAAb,CAFiE;IAAX,CAAxD;;;;;;;AAvIU,YAmJV,CAAU,aAAV,EAAyB,CAAzB,EAA4B,gBAA5B,CAA6C,QAA7C,EAAuD,UAAS,CAAT,EAAW;AAChE,OAAE,cAAF,GADgE;AAEhE,sBAFgE;AAGhE,YAAO,GAAP,CAAW,gBAAX,CAA4B,UAAU,cAAV,EAA0B,CAA1B,EAA6B,KAA7B,CAA5B,CAHgE;IAAX,CAAvD;;;;;;AAnJU,SA+JV,CAAO,OAAP,GAAiB,OAAO,OAAP,IAAkB,EAAlB,CA/JP;AAgKV,UAAO,OAAP,CAAe,GAAf,GAAqB,OAAO,MAAP,GAAgB;AACnC,iBAAY,sBAAU;AACpB,qBADoB;MAAV;AAGZ,2BAAsB,gCAAU;AAC9B,kBAAW,sHAAX,EAD8B;MAAV;AAGtB,kBAAa,uBAAU;AACrB,sBADqB;MAAV;IAPM;;;;;;AAhKX,OAiLN,gBAAgB,KAAhB;;;AAjLM,OAoLN,oBAAoB,SAApB,iBAAoB,GAAW;;;AAGjC,SAAI,CAAC,aAAD,EAAgB;AAClB,cADkB;MAApB;;AAIA,qBAPiC;IAAX,CApLd;;AA8LV,OAAI,yBAAyB,SAAzB,sBAAyB,CAAS,CAAT,EAAY;;;AAGvC,SAAI,KAAK,EAAE,OAAF,IAAa,EAAE,OAAF,KAAc,EAAd,EAAkB;AACtC,cADsC;MAAxC;;AAIA,SAAI,mBAAmB,IAAnB;;;AAPmC,oBAUvC,CACE;AADF,OAEE,OAFF,CAEW,UAAS,KAAT,EAAgB;;AAEzB,WAAI,MAAM,IAAN,KAAe,OAAf,EAAwB;AAC1B,aAAI,CAAC,MAAM,KAAN,CAAY,KAAZ,CAAkB,WAAlB,CAAD,IAAoC,MAAM,KAAN,KAAgB,MAAM,YAAN,CAAmB,OAAnB,CAAhB,EAA8C;AACpF,8BAAmB,KAAnB,CADoF;UAAtF;;;AAD0B,QAA5B,MAMO;AACL,eAAI,MAAM,KAAN,KAAgB,MAAM,YAAN,CAAmB,OAAnB,CAAhB,EAA6C;AAC/C,gCAAmB,KAAnB,CAD+C;YAAjD;UAPF;MAFS,CAFX;;;AAVuC,SA6BnC,gBAAJ,EAAsB;AACpB,uBAAgB,IAAhB,CADoB;AAEpB,2BAFoB;MAAtB,MAGO;AACL,uBAAgB,KAAhB,CADK;AAEL,wBAFK;MAHP;IA7B2B;;;AA9LnB,WAsOV,CAAS,gBAAT,CAA0B,kBAA1B,EAA8C,YAAW;;;AAGvD,uBAAkB,OAAlB,CAA2B,UAAS,KAAT,EAAgB;AACzC,aAAM,gBAAN,CAAuB,OAAvB,EAAgC,sBAAhC;AADyC,YAEzC,CAAM,gBAAN,CAAuB,QAAvB,EAAiC,sBAAjC;AAFyC,YAGzC,CAAM,gBAAN,CAAuB,OAAvB,EAAgC,sBAAhC;AAHyC,6BAIzC;AAJyC,MAAhB,CAA3B,CAHuD;;AAUvD,4BAVuD;IAAX,CAA9C;;;;;;;AAtOU,YA2PV,CAAU,gBAAV,EAA4B,CAA5B,EAA+B,gBAA/B,CAAgD,OAAhD,EAAyD,UAAS,CAAT,EAAW;AAClE,OAAE,cAAF,GADkE;AAElE,eAAU,MAAV,EAAkB,CAAlB,EAAqB,SAArB,CAA+B,GAA/B,CAAmC,aAAnC,EAFkE;AAGlE,4BAHkE;AAIlE,8BAJkE;IAAX,CAAzD,CA3PU;;AAkQV,aAAU,eAAV,EAA2B,CAA3B,EAA8B,gBAA9B,CAA+C,OAA/C,EAAwD,UAAS,CAAT,EAAW;AACjE,OAAE,cAAF,GADiE;AAEjE,eAAU,MAAV,EAAkB,CAAlB,EAAqB,SAArB,CAA+B,MAA/B,CAAsC,aAAtC,EAFiE;AAGjE,4BAHiE;AAIjE,8BAJiE;IAAX,CAAxD,CAlQU;EAAX,CAAD,6B","file":"login_main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap e5b4005e5e672232f369\n **/","// closure my locals\n(function() {\n\n  // ------------------------------------------------------------------------\n  //\n  // Helpers\n  //\n\n  // Helper for select elements by tag name into an array\n  var query_all = function(selector, visible_only) {\n    var items = Array.prototype.slice.call(document.querySelectorAll(selector));\n    if (visible_only) {\n      items = items.filter(function(el){\n        return el.offsetParent !== null;\n      });\n    }\n    return items;\n  };\n\n  // Gets all text inputs\n  var get_text_inputs = function(visible_only) {\n    return query_all('input[type=text],input[type=email],input[type=password]', visible_only);\n  };\n\n  // Focuses on first input\n  var focus_on_first_input = function() {\n    var input = get_text_inputs(\n      true // visible_only\n    )[0];\n    if (input) {\n      input.focus();\n      if (typeof input.select === 'function') {\n        input.select();\n      }\n    }\n  };\n\n  var enable_submit = function() {\n    // Enable the submit button\n    query_all('input[type=submit]').forEach(function(input) {\n      input.removeAttribute('disabled');\n    });\n  };\n\n  var disable_submit = function() {\n    // Disable the submit button\n    query_all('input[type=submit]').forEach(function(input) {\n      input.setAttribute('disabled','disabled');\n    });\n  };\n\n  var show_error = function(msg) {\n    query_all('.field-group',\n      true // visible_only\n    )[0].classList.add('error');\n    query_all('.field-group',\n      true // visible_only\n    )[0].innerHTML += '<div class=\"error-text\">' + msg + '</div>';\n  };\n\n  var clear_error = function() {\n    query_all('.field-group',\n      true // visible_only\n    )[0].classList.remove('error');\n    query_all('.error-text').forEach(function(el){\n      el.remove();\n    });\n  };\n\n\n\n  // ------------------------------------------------------------------------\n  //\n  // Server check\n  //\n\n  var last_domain_value = '';\n  var check_domain = function(domain) {\n    if (!domain) {\n      domain = last_domain_value;\n    }\n    last_domain_value = domain;\n    // Clean it up\n    domain = domain.replace(/(^.*:\\/\\/|^ *|\\/ *$| *$)/ig,'');\n\n    // Add the https back in\n    var full_url = 'https://' + domain;\n\n    // Try to check that url\n    clear_error();\n    disable_submit();\n    var xhr = new XMLHttpRequest();\n    var throw_xhr_error = function(){\n      enable_submit();\n      show_error('HipChat Server not found. Please ensure that the address is correct.');\n    };\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === xhr.DONE) {\n        if (xhr.status === 200) {\n          try {\n            var features = JSON.parse(xhr.responseText).features;\n\n          // Invaid JSON\n          } catch (e) {\n            throw_xhr_error();\n          }\n\n          // Parse the results of that JSON\n          var is_128_or_higher_supports_nonce = features.xmpp_compression;\n          var is_137_or_higher_supports_oauth = features.web_client_reconnect_header;\n\n          // Newer server\n          if (is_137_or_higher_supports_oauth) {\n            window.spi.onServerLoginShow(full_url);\n            window.spi.onServerOauthLogin(full_url);\n\n          // Older server\n          } else if (is_128_or_higher_supports_nonce) {\n            window.spi.onServerLoginShow(full_url);\n            document.location.href = full_url + '/sign_in';\n\n          // Got valid json, didn't get valid server data for desktop login\n          } else {\n            throw_xhr_error();\n          }\n\n        // Got a non 200 response\n        } else {\n          throw_xhr_error();\n        }\n      }\n    };\n    xhr.open('GET', full_url + '/api/features', true);\n    xhr.send();\n  };\n\n  query_all('#domain-form')[0].addEventListener('submit', function(e){\n    e.preventDefault();\n    check_domain(query_all('#domain-input')[0].value);\n  });\n\n\n\n  // ------------------------------------------------------------------------\n  //\n  // Cloud Login\n  //\n\n  query_all('#login-form')[0].addEventListener('submit', function(e){\n    e.preventDefault();\n    disable_submit();\n    window.spi.onCloudLoginShow(query_all('#email-input')[0].value);\n  });\n\n\n\n  // ------------------------------------------------------------------------\n  //\n  // QT/MAC Api\n  //\n  window.HCLogin = window.HCLogin || {};\n  window.HCLogin.API = window.macapi = {\n    clearError: function(){\n      clear_error();\n    },\n    showCertificateError: function(){\n      show_error(\"You chose to not trust this HipChat Server's certificate. Check with your admins to find out if you should trust it.\");\n    },\n    retrySubmit: function(){\n      check_domain();\n    }\n  };\n\n\n  // ------------------------------------------------------------------------\n  //\n  // Enable / Disable buttons\n  //\n  var inputs_passed = false;\n\n  // Will only enable submit if captcha is passed\n  var try_enable_submit = function() {\n\n    // Test whether the inputs were passing\n    if (!inputs_passed) {\n      return;\n    }\n\n    enable_submit();\n  };\n\n  var check_field_validation = function(e) {\n\n    // Ignore enter key presses so doesnt re-enable on submit\n    if (e && e.keyCode && e.keyCode === 13) {\n      return;\n    }\n\n    var all_fields_valid = true;\n\n    // All input fields\n    get_text_inputs(\n      true // visible_only\n    ).forEach( function(input) {\n\n      if (input.type === 'email') {\n        if (!input.value.match(/.+@.+\\..+/) || (input.value === input.getAttribute('value'))) {\n          all_fields_valid = false;\n        }\n\n      // Normal case of detecting based on current value, against original html attribute value\n      } else {\n        if (input.value === input.getAttribute('value')) {\n          all_fields_valid = false;\n        }\n      }\n\n    }); // end forEach on inputs\n\n    // Based on results from all fields, enable or disable\n    if (all_fields_valid) {\n      inputs_passed = true;\n      try_enable_submit();\n    } else {\n      inputs_passed = false;\n      disable_submit();\n    }\n\n  }; // end check_field_validation\n\n  // Wait until dom load for interacting with dom\n  document.addEventListener(\"DOMContentLoaded\", function() {\n\n    // When any input is changed ...\n    get_text_inputs().forEach( function(input) {\n      input.addEventListener('keyup', check_field_validation);  // captures most cases\n      input.addEventListener('change', check_field_validation); // this is just paranoia, maybe not necessary\n      input.addEventListener('input', check_field_validation);  // detects paste events\n      check_field_validation();                                 // detects cases of password managers\n    });\n\n    focus_on_first_input();\n\n  }); // end DOMContentLoaded\n\n\n\n  // ------------------------------------------------------------------------\n  //\n  // Toggle between server / login\n  //\n\n  query_all('#select-server')[0].addEventListener('click', function(e){\n    e.preventDefault();\n    query_all('body')[0].classList.add('server-mode');\n    focus_on_first_input();\n    check_field_validation();\n  });\n\n  query_all('#select-login')[0].addEventListener('click', function(e){\n    e.preventDefault();\n    query_all('body')[0].classList.remove('server-mode');\n    focus_on_first_input();\n    check_field_validation();\n  });\n\n})(); // end closure for locals\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/native/login/login_main.js\n **/"],"sourceRoot":""}