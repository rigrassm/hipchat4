if(function(){"use strict";AJS.I18n.keys["cp.footer.expand.minimode"]="Show all files",AJS.I18n.keys["cp.footer.close.minimode"]="Hide all files",AJS.I18n.keys["cp.thumbnail.description"]="View a larger version of {0}",AJS.I18n.keys["cp.expand.thumbnail.minimode"]="Show all files",AJS.I18n.keys["cp.close.thumbnail.minimode"]="Hide all files",AJS.I18n.keys["cp.go.to.prev"]="Go to the previous file",AJS.I18n.keys["cp.go.to.next"]="Go to the next file",AJS.I18n.keys["cp.go.to.prev.page"]="Previous page",AJS.I18n.keys["cp.go.to.next.page"]="Next page",AJS.I18n.keys["cp.close"]="Close",AJS.I18n.keys["cp.download.original"]="Download",AJS.I18n.keys["cp.fit.to.page"]="Fit to page",AJS.I18n.keys["cp.zoom.in"]="Zoom in",AJS.I18n.keys["cp.zoom.out"]="Zoom out",AJS.I18n.keys["cp.enter.presentation.mode"]="Start Presentation",AJS.I18n.keys["cp.exit.presentation.mode"]="Exit Presentation",AJS.I18n.keys["cp.image.load.fail.header"]="Image could not be loaded.",AJS.I18n.keys["cp.image.load.fail"]="Unable to load file from {0}.",AJS.I18n.keys["cp.show.more"]="More",AJS.I18n.keys["cp.edit.file"]="Edit file",AJS.I18n.keys["cp.print.file"]="Print",AJS.I18n.keys["cp.delete.file"]="Delete",AJS.I18n.keys["cp.arrow.left.disabled"]="You''re viewing the least recent file",AJS.I18n.keys["cp.arrow.right.disabled"]="You''re viewing the most recent file",AJS.I18n.keys["cp.password.protected"]="Enter the password to open this file:",AJS.I18n.keys["cp.password.needed"]="Please enter the password to view this file.",AJS.I18n.keys["cp.password.incorrect"]="Invalid password. Please try again.",AJS.I18n.keys["cp.password.input.placeholder"]="Password",AJS.I18n.keys["cp.password.button.ok"]="OK",AJS.I18n.keys["cp.password.fullscreen.title"]="This file is password protected.",AJS.I18n.keys["cp.password.fullscreen.message"]="Due to technical reasons you have to leave presentation mode to enter the password.",AJS.I18n.keys["cp.error.button.download"]="Download",AJS.I18n.keys["cp.error.button.browser"]="Open in browser",AJS.I18n.keys["cp.error.image.missing.header"]="Ouch! We can''t load the image.",AJS.I18n.keys["cp.error.pdf.missing.header"]="Ouch! We can''t load the PDF.",AJS.I18n.keys["cp.error.media.default.header"]="Ouch! We can''t load the media file.",AJS.I18n.keys["cp.error.pdf.password.header"]="Ouch! We can''t show password protected files yet.",AJS.I18n.keys["cp.error.pdf.password.message"]="Try downloading the file to view it.",AJS.I18n.keys["cp.error.pdf.invalid.header"]="Ouch! Looks like this document is broken.",AJS.I18n.keys["cp.error.pdf.invalid.message"]="Try downloading the file to view it.",AJS.I18n.keys["cp.error.pdf.default.header"]="Ouch! Something is wrong with this file.",AJS.I18n.keys["cp.error.pdf.default.message"]="Try downloading the file to view it.",AJS.I18n.keys["cp.error.default.header"]="Ouch! We can''t preview this file.",AJS.I18n.keys["cp.error.file.not.found"]="The file does not exist.",AJS.I18n.keys["cp.error.file.no.viewer"]="There is not viewer for this file type.",AJS.I18n.keys["cp.file.converting.message.header"]="Your preview is on its way!",AJS.I18n.keys["cp.file.converting.message.text"]="In a hurry? You can download the original right now.",AJS.I18n.keys["cp.unknown.file.type.header"]="Ouch! We can''t preview this file type.",AJS.I18n.keys["cp.unknown.file.type.download.to.view"]="Try downloading the file to view it.",AJS.I18n.keys["cp.unknown.file.type.downloadbutton"]="Download",AJS.I18n.keys["cp.unsupported.browser.header"]="Your browser can''t preview this file.",AJS.I18n.keys["cp.unsupported.browser.download.to.view"]="You''ll have to download the file or use a different browser to view it."}(),"undefined"==typeof FileViewer)var FileViewer={};if("undefined"==typeof FileViewer.Templates&&(FileViewer.Templates={}),FileViewer.Templates.fileView=function(e,t){return'<div id="cp-header" class="aui-group"></div><div id="cp-body" class="aui-group"></div><div id="cp-footer"></div>'},goog.DEBUG&&(FileViewer.Templates.fileView.soyTemplateName="FileViewer.Templates.fileView"),FileViewer.Templates.titleContainer=function(e,t){return'<span class="'+soy.$$escapeHtml(e.iconClass)+' size-24 cp-file-icon"></span>'+soy.$$escapeHtml(e.title)},goog.DEBUG&&(FileViewer.Templates.titleContainer.soyTemplateName="FileViewer.Templates.titleContainer"),FileViewer.Templates.controlDownloadButton=function(e,t){return'<a role="button" tabindex="55" id="cp-control-panel-download" href="'+soy.$$escapeHtml(e.src)+'" title="'+soy.$$escapeHtml(AJS.I18n.getText("cp.download.original"))+'" class="cp-icon" target="_blank" download>'+soy.$$escapeHtml(AJS.I18n.getText("cp.download.original"))+"</a>"},goog.DEBUG&&(FileViewer.Templates.controlDownloadButton.soyTemplateName="FileViewer.Templates.controlDownloadButton"),FileViewer.Templates.controlCloseButton=function(e,t){return'<button role="button" tabindex="60" id="cp-control-panel-close" href="#" title="'+soy.$$escapeHtml(AJS.I18n.getText("cp.close"))+'" class="cp-icon">'+soy.$$escapeHtml(AJS.I18n.getText("cp.close"))+"</button>"},goog.DEBUG&&(FileViewer.Templates.controlCloseButton.soyTemplateName="FileViewer.Templates.controlCloseButton"),FileViewer.Templates.moreButton=function(e,t){return'<button role="button" tabindex="50" id="cp-control-panel-more" aria-owns="cp-more-menu" aria-haspopup="true" class="cp-icon aui-dropdown2-trigger aui-dropdown2-trigger-arrowless" title="'+soy.$$escapeHtml(AJS.I18n.getText("cp.show.more"))+'">'+soy.$$escapeHtml(AJS.I18n.getText("cp.show.more"))+'</button><div id="cp-more-menu" class="aui-dropdown2 aui-style-default" data-fv-allow-focus><ul class="aui-list-truncate"></ul></div>'},goog.DEBUG&&(FileViewer.Templates.moreButton.soyTemplateName="FileViewer.Templates.moreButton"),FileViewer.Templates.moreMenuItem=function(e,t){return'<li><a href="#">'+soy.$$escapeHtml(e.text)+"</a></li>"},goog.DEBUG&&(FileViewer.Templates.moreMenuItem.soyTemplateName="FileViewer.Templates.moreMenuItem"),FileViewer.Templates.fileComments=function(e,t){return'<div id="cp-comments"/>'},goog.DEBUG&&(FileViewer.Templates.fileComments.soyTemplateName="FileViewer.Templates.fileComments"),FileViewer.Templates.fileBodySpinner=function(e,t){return'<div class="cp-spinner"></div>'},goog.DEBUG&&(FileViewer.Templates.fileBodySpinner.soyTemplateName="FileViewer.Templates.fileBodySpinner"),FileViewer.Templates.fileBodyArrows=function(e,t){return'<button class="cp-nav" id="cp-nav-left" tabindex=20 disabled-title="'+soy.$$escapeHtml(AJS.I18n.getText("cp.arrow.left.disabled"))+'">'+soy.$$escapeHtml(AJS.I18n.getText("cp.go.to.prev"))+'</button><button class="cp-nav" id="cp-nav-right" tabindex=20  disabled-title="'+soy.$$escapeHtml(AJS.I18n.getText("cp.arrow.right.disabled"))+'">'+soy.$$escapeHtml(AJS.I18n.getText("cp.go.to.next"))+"</button>"},goog.DEBUG&&(FileViewer.Templates.fileBodyArrows.soyTemplateName="FileViewer.Templates.fileBodyArrows"),"undefined"==typeof FileViewer)var FileViewer={};if("undefined"==typeof FileViewer.Templates&&(FileViewer.Templates={}),FileViewer.Templates.unknownFileTypeViewer=function(e,t){return'<div id="cp-unknown-file-type-view"><span class="file-icon size-96 '+soy.$$escapeHtml(e.iconClass)+'"></span><p class="title">'+soy.$$escapeHtml(AJS.I18n.getText("cp.unknown.file.type.header"))+"<br>"+soy.$$escapeHtml(AJS.I18n.getText("cp.unknown.file.type.download.to.view"))+'</p><a class="aui-button download-button" href="'+soy.$$escapeHtml(e.src)+'" target="_blank" download><span class="aui-icon aui-icon-small icon-download"></span>'+soy.$$escapeHtml(AJS.I18n.getText("cp.unknown.file.type.downloadbutton"))+'</a></div><span class="cp-baseline-extension"></span>'},goog.DEBUG&&(FileViewer.Templates.unknownFileTypeViewer.soyTemplateName="FileViewer.Templates.unknownFileTypeViewer"),"undefined"==typeof FileViewer)var FileViewer={};if("undefined"==typeof FileViewer.Templates&&(FileViewer.Templates={}),FileViewer.Templates.displayError=function(e,t){return'<div id="cp-error-message">'+(e.icon?'<span class="file-icon size-96 '+soy.$$escapeHtml(e.icon)+'"></span>':'<span class="file-icon size-96 cp-unknown-file-type-icon"></span>')+'<p class="title">'+soy.$$escapeHtml(e.title)+'</p><p class="message">'+soy.$$escapeHtml(e.message)+"</p>"+(e.srcBrowser?'<a class="aui-button download-button" href="'+soy.$$escapeHtml(e.srcBrowser)+'" target="_blank"><span class="aui-icon aui-icon-small icon-download"></span>'+soy.$$escapeHtml(AJS.I18n.getText("cp.error.button.browser"))+"</a>":"")+(e.srcDownload?'<a class="aui-button download-button" href="'+soy.$$escapeHtml(e.srcDownload)+'" target="_blank" download><span class="aui-icon aui-icon-small icon-download"></span>'+soy.$$escapeHtml(AJS.I18n.getText("cp.error.button.download"))+"</a>":"")+'</div><span class="cp-baseline-extension"></span>'},goog.DEBUG&&(FileViewer.Templates.displayError.soyTemplateName="FileViewer.Templates.displayError"),FileViewer.Templates.passwordLayer=function(e,t){return'<div id="cp-preview-password"><span class="cp-password-lock-icon"></span><div class="cp-password-base"><p class="title">'+soy.$$escapeHtml(e.prompt)+'</p><input tabindex="5" type="password" name="password" class="cp-password-input" placeholder="'+soy.$$escapeHtml(AJS.I18n.getText("cp.password.input.placeholder"))+'" autocomplete="off"><button tabindex="10" class="aui-button cp-password-button">'+soy.$$escapeHtml(AJS.I18n.getText("cp.password.button.ok"))+'</button></div><div class="cp-password-fullscreen"><p class="title">'+soy.$$escapeHtml(AJS.I18n.getText("cp.password.fullscreen.title"))+'</p><p class="message">'+soy.$$escapeHtml(AJS.I18n.getText("cp.password.fullscreen.message"))+'</p></div></div><span class="cp-baseline-extension"></span>'},goog.DEBUG&&(FileViewer.Templates.passwordLayer.soyTemplateName="FileViewer.Templates.passwordLayer"),FileViewer.Templates.waitingMessage=function(e,t){return'<div id="cp-waiting-message"><span class="file-icon size-96 cp-waiting-message-spinner"></span><p class="title">'+soy.$$escapeHtml(e.header)+'</p><p class="message">'+soy.$$escapeHtml(e.message)+'</p><a class="aui-button download-button" href="'+soy.$$escapeHtml(e.src)+'" target="_blank" download><span class="aui-icon aui-icon-small icon-download"></span>'+soy.$$escapeHtml(AJS.I18n.getText("cp.download.original"))+'</a></div><span class="cp-baseline-extension"></span>'},goog.DEBUG&&(FileViewer.Templates.waitingMessage.soyTemplateName="FileViewer.Templates.waitingMessage"),FileViewer.Templates.toolbar=function(e,t){for(var i='<div class="cp-toolbar">',n=e.actions,o=n.length,s=0;o>s;s++){var r=n[s];i+='<button tabindex="'+soy.$$escapeHtml(s+10)+'" class="'+soy.$$escapeHtml(r.className)+' cp-icon" title="'+soy.$$escapeHtml(r.title)+'">'+soy.$$escapeHtml(r.title)+"</button>"}return i+="</div>"},goog.DEBUG&&(FileViewer.Templates.toolbar.soyTemplateName="FileViewer.Templates.toolbar"),"undefined"==typeof FileViewer)var FileViewer={};if("undefined"==typeof FileViewer.Templates&&(FileViewer.Templates={}),FileViewer.Templates.previewBody=function(e,t){return'<div class="cp-scale-info" /><div class="cp-image-container" /><span class="cp-baseline-extension"></span>'},goog.DEBUG&&(FileViewer.Templates.previewBody.soyTemplateName="FileViewer.Templates.previewBody"),"undefined"==typeof FileViewer)var FileViewer={};if("undefined"==typeof FileViewer.Templates&&(FileViewer.Templates={}),"undefined"==typeof FileViewer.Templates.avPlayer&&(FileViewer.Templates.avPlayer={}),FileViewer.Templates.avPlayer.playerBody=function(e,t){return'<div class="cp-video-container">'+("audio"==e.kind?'<audio id="cp-video-player" class="video-js vjs-atlassian-skin" poster="'+soy.$$escapeHtml(e.poster)+'"><source src="'+soy.$$escapeHtml(e.src)+'" type="'+soy.$$escapeHtml(e.type)+'" /></audio>':'<video id="cp-video-player" class="video-js vjs-atlassian-skin" poster="'+soy.$$escapeHtml(e.poster)+'"><source src="'+soy.$$escapeHtml(e.src)+'" type="'+soy.$$escapeHtml(e.type)+'" /></video>')+'</div><span class="cp-baseline-extension"></span>'},goog.DEBUG&&(FileViewer.Templates.avPlayer.playerBody.soyTemplateName="FileViewer.Templates.avPlayer.playerBody"),FileViewer.Templates.avPlayer.progressTooltip=function(e,t){return"<div id='vjs-tip'><div id='vjs-tip-arrow'></div><div id='vjs-tip-inner'></div></div>"},goog.DEBUG&&(FileViewer.Templates.avPlayer.progressTooltip.soyTemplateName="FileViewer.Templates.avPlayer.progressTooltip"),FileViewer.Templates.avPlayer.customControlBarItem=function(e,t){return'<div class="vjs-control-content"><span class="vjs-control-text">'+soy.$$escapeHtml(e.descr)+"</span></div>"},goog.DEBUG&&(FileViewer.Templates.avPlayer.customControlBarItem.soyTemplateName="FileViewer.Templates.avPlayer.customControlBarItem"),"undefined"==typeof FileViewer)var FileViewer={};"undefined"==typeof FileViewer.Templates&&(FileViewer.Templates={}),FileViewer.Templates.metabar=function(e,t){return'<div class="cp-meta-bar"><div class="cp-meta-bar-left">'+(e.avatarSrc?'<div class="cp-meta-avatar"><img class="cp-meta-avatar-image" src="'+soy.$$escapeHtml(e.avatarSrc)+'" alt="'+soy.$$escapeHtml(e.author)+'"></div>':"")+'<span class="cp-meta-shared-by">'+(e.author?(e.authorPrefix?'<span class="cp-meta-shared-by-prefix">'+soy.$$escapeHtml(e.authorPrefix)+"</span>":"")+soy.$$escapeHtml(e.author)+"</span>":"")+(e.date?'<span class="cp-meta-shared-at">'+soy.$$escapeHtml(e.date)+(e.time?'<span class="cp-meta-shared-at-time">'+soy.$$escapeHtml(e.time)+"</span>":""):"")+'</span></div><div class="cp-meta-bar-right">'+(e.fileType?'<span class="cp-meta-file-type">'+soy.$$escapeHtml(e.fileType)+"</span>":"")+(e.fileSize?'<span class="cp-meta-file-size">'+soy.$$escapeHtml(e.fileSize)+"</span>":"")+"</div></div>"},goog.DEBUG&&(FileViewer.Templates.metabar.soyTemplateName="FileViewer.Templates.metabar"),function(){"use strict";var e={},t=function(t,i,n){e[t]={deps:i,factory:n,value:null}},i=function(t,n){var o=i._normalizeMocks(n)[t]||e[t];if(!o)throw new Error("module not found "+t);return o.value||(o.value=o.factory.apply(null,o.deps.map(function(e){return i(e,n)}))),o.value};i._normalizeMocks=function(e){if(!e)return{};var t={};return Object.keys(e).forEach(function(i){t[i]={deps:[],factory:function(){return e[i]},value:null}}),t},t("jquery",[],function(){return jQuery}),t("underscore",[],function(){return _}),t("backbone",[],function(){return Backbone}),t("ajs",[],function(){return AJS}),t("Analytics",["underscore"],function(e){var t=function(e,t,i){this._backend=e,this._fileViewer=t,this._hasher=i};return t.prototype.send=function(t,i){if(this._backend){var n=this._fileViewer.getCurrentFile(),o=n&&n.attributes||{},s=e.extend({fileType:o.type,fileId:this._hasher(o.src||""),fileState:this._fileViewer.getView().getViewState()},i);this._backend(t,s)}},t.prototype.fn=function(e,t){return this.send.bind(this,e,t)},t}),t("ArrowLayer",["backbone","template-store-singleton"],function(e,t){var i=e.View.extend({className:"cp-arrow-layer",events:{"click #cp-nav-left:not(.disabled)":"gotoPrevious","click #cp-nav-right:not(.disabled)":"gotoNext"},initialize:function(e){this._fileViewer=e.fileViewer,this.listenTo(this._fileViewer._fileState.collection,"add reset",this.checkAndHideNavigation),this._visibleArrows=!1,this._updateElements()},render:function(){return this.$el.html(t.get("fileBodyArrows")()).hide(),this._updateElements(),this.checkAndHideNavigation(),this},gotoNext:function(){this._fileViewer.showFileNext().always(this._fileViewer.analytics.fn("files.fileviewer-web.next",{actionType:"button",mode:this._fileViewer.getMode()}))},gotoPrevious:function(){this._fileViewer.showFilePrev().always(this._fileViewer.analytics.fn("files.fileviewer-web.prev",{actionType:"button",mode:this._fileViewer.getMode()}))},enableArrow:function(e){e.removeClass("disabled"),e.removeAttr("original-title")},disableArrow:function(e){e.arrow.addClass("disabled"),e.arrow.attr("original-title",e.tooltipText),e.arrow.tooltip({gravity:e.tooltipGravity})},showsArrow:function(){return this._visibleArrows},checkAndHideNavigation:function(){return this._fileViewer._fileState.collection.length<=1?(this._visibleArrows=!1,this.$arrows.hide()):(this.$arrows.show(),this._visibleArrows=!0,void(this._fileViewer.getConfig().enableListLoop||(this._fileViewer.isShowingLastFile()?this.disableArrow({arrow:this.$arrowRight,tooltipText:AJS.I18n.getText("cp.arrow.right.disabled"),tooltipGravity:"e"}):this._fileViewer.isShowingFirstFile()&&this.disableArrow({arrow:this.$arrowLeft,tooltipText:AJS.I18n.getText("cp.arrow.left.disabled"),tooltipGravity:"w"}))))},_updateElements:function(){this.$arrows=this.$el.find(".cp-nav"),this.$arrowLeft=this.$el.find("#cp-nav-left"),this.$arrowRight=this.$el.find("#cp-nav-right")}});return i}),t("assert",[],function(){var e=function(e,t){if(t=t||"untruthy value",!e)throw new Error("Assertion failed: "+t)};return e}),t("asset-module-backend",[],function(){return function(e){return function(t){return"pdf-config"===t?e.getConfig().assets["pdf-config"]||{}:void 0}}}),t("baseMode",["jquery","keys"],function(e,t){var i={activateHook:function(e){e.$el.on("click #cp-file-body",e._onClickToBackground.bind(e));var t=e.fileContentView.getLayerForName("arrows").$el;t.toggle(this.showsArrowLayer)},deactivateHook:function(e){e.$el.off("click #cp-file-body")},setup:function(t,i){i&&i.$el.on("click.contentView",i._clickedBackgroundToClose.bind(i)),e(document).on("keydown.modeKeys",this._handleKeys.bind(t))},teardown:function(t,i){i&&i.$el.off("click.contentView"),e(document).off("keydown.modeKeys")},showsArrowLayer:!0,_handleKeys:function(e){var i,n;this.fileContentView.isLayerInitialized("content")&&(i=this.fileContentView.getLayerForName("content"),n=i.getAttachedViewer()),n&&(e.ctrlKey||e.metaKey)&&((e.which===t.PLUS||e.which===t.PLUS_NUMPAD||e.which===t.PLUS_FF)&&(n.zoomIn&&(this._fileViewer.analytics.send("files.fileviewer-web.file.zoomin",{actionType:"hotkey"}),n.zoomIn()),e.preventDefault()),(e.which===t.MINUS||e.which===t.MINUS_NUMPAD||e.which===t.MINUS_FF)&&(n.zoomOut&&(this._fileViewer.analytics.send("files.fileviewer-web.file.zoomout",{actionType:"hotkey"}),n.zoomOut()),e.preventDefault()))},toolbarActions:[{title:AJS.I18n.getText("cp.zoom.out"),className:"cp-toolbar-minus",predicate:function(){return this._viewer&&this._viewer.zoomOut},handler:function(){this._viewer&&this._viewer.zoomOut&&(this._fileViewer.analytics.send("files.fileviewer-web.file.zoomout",{actionType:"button"}),this._viewer.zoomOut())}},{title:AJS.I18n.getText("cp.zoom.in"),className:"cp-toolbar-plus",predicate:function(){return this._viewer&&this._viewer.zoomIn},handler:function(){this._viewer&&this._viewer.zoomIn&&(this._fileViewer.analytics.send("files.fileviewer-web.file.zoomin",{actionType:"button"}),this._viewer.zoomIn())}},{title:AJS.I18n.getText("cp.fit.to.page"),className:"cp-toolbar-fit",predicate:function(){return this._viewer&&this._viewer.zoomFit},handler:function(){this._viewer&&this._viewer.zoomFit&&(this._fileViewer.analytics.send("files.fileviewer-web.file.zoomfit",{actionType:"button"}),this._viewer.zoomFit())}},{title:AJS.I18n.getText("cp.enter.presentation.mode"),className:"cp-toolbar-presentation",predicate:function(){return this._viewer&&this._fileViewer.getConfig().enablePresentationMode},handler:function(){this._fileViewer.analytics.send("files.fileviewer-web.presentation.enter"),this._fileViewer.changeMode("PRESENTATION")}}]};return i}),t("BaseViewer",["jquery","underscore","backbone"],function(e,t,i){var n=i.View.extend({contentViewEvents:{"click.contentView":"_clickedBackgroundToClose","mousedown.contentView":"_mousedownContentView"},initialize:function(e){this.events=t.extend(this.events||{},this.contentViewEvents),this._fileViewer=e.fileViewer,this._previewSrc=e.previewSrc,this._mousedownBackground=null},teardown:function(){},_mousedownContentView:function(t){var i=this.getBackground?this.getBackground():this.$el;this._mousedownBackground=e(t.target).is(i)},_clickedBackgroundToClose:function(t){var i=this._fileViewer._view._modes[this._fileViewer._view._mode];if(!i.disableClickBackgroundCloses){var n=this.getBackground?this.getBackground():this.$el;this._mousedownBackground&&e(t.target).is(n)&&(this._fileViewer.analytics.send("files.fileviewer-web.closed",{actionType:"element"}),this._fileViewer.close())}},handleResize:function(){}});return n}),t("CloseButton",["backbone","template-store-singleton"],function(e,t){var i=e.View.extend({className:"fv-close-button",events:{click:"_close"},tagName:"span",initialize:function(e){this._fileViewer=e.fileViewer},render:function(){return this.$el.html(t.get("controlCloseButton")()),this.$("button").tooltip({gravity:"n"}),this},_close:function(e){e.preventDefault(),this._fileViewer.analytics.send("files.fileviewer-web.closed",{actionType:"button"}),this._fileViewer.close()}});return i}),t("Commands",["jquery","ajs","file"],function(e,t,i){var n=function(t){return(new e.Deferred).reject(new Error(t)).promise()},o={};return o.LookupViewer=function(e,t){this._originalFile=e,this._viewerRegistry=t},o.LookupViewer.prototype.execute=function(o,s,r){var a=new i(this._originalFile.toJSON());a.set(r),a.set("type",s),a.set("src",o);var l=this._viewerRegistry.get(s);if(!l)return n(t.I18n.getText("cp.error.file.no.viewer"));var c=e.Deferred();return l().then(function(e){c.resolve(e,o,a)}).fail(function(){c.fail(arguments)}),c.promise()},o}),t("defaultConfig",[],function(){return{enableListLoop:!0,enablePresentationMode:!0,preloadImagesAfterCurrent:2,preloadImagesBeforeCurrent:0,videoDefaultQualityHd:!0,customStorage:null,viewers:["image","document","video"]}}),t("constants-dictionary",["assert"],function(e){var t=function(){this._valuesByName={},this._names=[]};return t.prototype.define=function(t,i){e(!this.isDefined(t),"name is unique"),this._valuesByName[t]=i,this._names.push(t)},t.prototype.lookup=function(t){return e(this.isDefined(t),"name is defined"),this._valuesByName[t]},t.prototype.isDefined=function(e){return e in this._valuesByName},t.prototype.list=function(){return this._names.map(function(e){return{name:e,value:this._valuesByName[e]}},this)},t}),t("djb2",[],function(){var e=function(e){return e.charCodeAt(0)},t=function(e,t){return(e<<5)+e+t},i=function(i){return i.split("").map(e).reduce(t,5381)};return i}),t("DownloadButton",["backbone","template-store-singleton"],function(e,t){var i=e.View.extend({tagName:"span",events:{click:"_triggerAnalytics"},initialize:function(e){this._fileViewer=e.fileViewer,this._model=this._fileViewer.getCurrentFile()},render:function(){return this.$el.html(t.get("controlDownloadButton")({src:this._model.get("srcDownload")||this._model.get("src")})),this.$("a").tooltip({gravity:"n"}),this},_triggerAnalytics:function(e){this._fileViewer.trigger("fv.download",e),this._fileViewer.analytics.send("files.fileviewer-web.file.download",{actionType:"button"})}},{isDownloadable:function(e){var t=e.getCurrentFile();return t&&t.get("downloadable")}});return i}),t("ErrorLayer",["ajs","backbone","template-store-singleton"],function(e,t,i){var n=t.View.extend({className:"cp-error-layer",initialize:function(){this.$el.hide()},showErrorMessage:function(t,n){var o,s,r,a,l;o=t.title||e.I18n.getText("cp.error.default.header"),s=t.description||t.toString(),r=t.icon||!1,l=t.browser?n.get("src"):!1,a=t.download?n.get("src"):!1,this.$el.show().html(i.get("displayError")({title:o,message:s,icon:r,srcBrowser:l,srcDownload:a}))}});return n}),t("file-state",["backbone"],function(e){var t=e.Model.extend({defaults:{currentFileIndex:-1,isNewFileUploaded:!1},setCollection:function(e){this.collection=e},setNext:function(){var e=this.get("currentFileIndex");e<this.collection.length-1?this.set({currentFileIndex:this.get("currentFileIndex")+1}):this.set({currentFileIndex:0})},setPrev:function(){var e=this.get("currentFileIndex");e>0?this.set({currentFileIndex:this.get("currentFileIndex")-1}):this.set({currentFileIndex:this.collection.length-1})},setNoCurrent:function(){this.set({currentFileIndex:-1})},setCurrentFileIndex:function(e){return e>-1&&e<this.collection.length?this.set({currentFileIndex:e}):void 0},setCurrentWithCID:function(e){return this.setCurrentFileIndex(this.collection.getIndexWithCID(e))},getCurrent:function(){var e=this.collection.at(this.get("currentFileIndex"));return e?e:null},selectWhere:function(e){if(e){var t=this.collection.findWhere(e);t&&this.setCurrentWithCID(t.cid)}else this.collection.length>=1&&this.setCurrentFileIndex(0)},replaceCurrent:function(e){var t=this.get("currentFileIndex");this.collection.remove(this.collection.at(t)),this.collection.add(e,{at:t})},setCurrentWithQuery:function(e){var t=this.collection.findWhere(e);t?this.setCurrentWithCID(t.cid):this.setNoCurrent()}});return t}),t("file-types",[],function(){var e=["image/gif","image/jpeg","image/png","image/svg+xml","image/web","image/bmp"],t=["video/mp4","video/m4v","video/youtube","audio/mp3","audio/mpeg"],i=function(e){return e&&e.toLowerCase()||""},n={isPDF:function(e){var t=i(e);return"application/pdf"===t},isText:function(e){var t=i(e);return"text/plain"===t},isCode:function(e){var t=i(e);return"text/java"===t||"text/css"===t||"text/html"===t||"text/javascript"===t||"text/xml"===t},isMultimedia:function(e){var t=i(e);return/^video\/.*/i.test(e)||/^audio\/.*/i.test(e)||"application/x-shockwave-flash"===t||"application/vnd.rn-realmedia"===t||"application/x-oleobject"===t},isArchive:function(e){var t=i(e);return"application/zip"===t||"application/java-archive"===t},isImage:function(e){return/^image\/.*/i.test(e)},isVideo:function(e){var t=i(e);return/^video\/.*/i.test(e)||"video"===t},isAudio:function(e){var t=i(e);return/^audio\/.*/i.test(e)||"audio"===t},isYoutube:function(e){var t=i(e);return"video/youtube"===t},isImageBrowserSupported:function(t){return-1!==e.indexOf(t.toLowerCase())},isMultimediaBrowserSupported:function(e){return-1!==t.indexOf(e.toLowerCase())},isWordProcessing:function(e){var t=i(e);return"application/msword"===t||/^application\/vnd.ms-word.*/i.test(e)||/^application\/vnd.openxmlformats-officedocument.wordprocessingml.*/i.test(e)},isSpreadsheet:function(e){var t=i(e);return"application/msexcel"===t||/^application\/vnd.ms-excel.*/i.test(e)||/^application\/vnd.openxmlformats-officedocument.spreadsheet.*/i.test(e)},isPresentation:function(e){var t=i(e);return"application/mspowerpoint"===t||/^application\/vnd.ms-powerpoint.*/i.test(e)||/^application\/vnd.openxmlformats-officedocument.presentationml.*/i.test(e)},matchAll:function(){return!0}};return n}),t("file-viewer",["jquery","underscore","backbone","assert","constants-dictionary","MainView","file-state","files","file","soy-template-backend","asset-module-backend","template-store-singleton","module-store-singleton","viewer-registry","file-types","defaultConfig","storage","image-view-provider","pdf-view-provider","video-view-provider","unknown-file-type-view-provider","Analytics","djb2"],function(n,o,s,r,a,l,c,d,u,h,p,f,w,g,m,v,y,_,b,V,S,F,T){var k=function(e){e=o.defaults(e||{},v),e.appendTo=e.appendTo||n("body"),f.useBackend(e.templateBackend||h(this)),w.useBackend(e.moduleBackend||p(this)),this._config=e,this._properties=new s.Model,this._fileState=new c,this._viewerRegistry=new g,this._analytics=new F(e.analyticsBackend,this,T),-1!==e.viewers.indexOf("image")&&this._viewerRegistry.register(m.isImageBrowserSupported,_,0),-1!==e.viewers.indexOf("document")&&this._viewerRegistry.register(m.isPDF,b,0),-1!==e.viewers.indexOf("video")&&this._viewerRegistry.register(m.isMultimediaBrowserSupported,V,0),this._viewerRegistry.register(m.matchAll,S,100),this._files=new d(e.files||[],{service:e.commentService}),this._fileState.setCollection(this._files),this._view=new l({fileViewer:this}),this._isOpen=!1,this._storage=new y(this.getConfig().customStorage,"fileViewer."),k._plugins.list().map(function(e){return e.value}).forEach(function(e){e(this)},this)};return k._modules=e,k._plugins=new a,k.VERSION="1.4.1",k.define=t,k.require=i,k.registerPlugin=function(e,t){r(this.isPlugin(t),"is a plugin"),this._plugins.define(e,t)},k.isPluginEnabled=function(e){return this._plugins.isDefined(e)},k.getPlugin=function(e){return this._plugins.lookup(e)},k.isPlugin=function(e){return o.isFunction(e)},o.extend(k.prototype,s.Events),Object.defineProperty(k.prototype,"analytics",{get:function(){return this._analytics}}),k.prototype.open=function(e,t){this._view.render().show().$el.appendTo(this._config.appendTo),this._view.delegateEvents(),this._isOpen=!0,this.trigger("fv.open"),e&&this.showFileWithQuery(e).always(this.analytics.fn("files.fileviewer-web.opened",{source:t}))},k.prototype.close=function(){this._view._currentFile=null,this._view.undelegateEvents(),this._view.hide().$el.remove(),this._isOpen=!1,this.trigger("fv.close")},k.prototype.isOpen=function(){return this._isOpen},k.prototype.showFileWithQuery=function(e){this._fileState.setCurrentWithQuery(e);var t=this._fileState.getCurrent();return this.showFile(t)},k.prototype.showFileNext=function(){return this.isShowingLastFile()&&!this.getConfig().enableListLoop?n.when():(this._fileState.setNext(),this.showFile(this._fileState.getCurrent()))},k.prototype.showFilePrev=function(){return this.isShowingFirstFile()&&!this.getConfig().enableListLoop?n.when():(this._fileState.setPrev(),this.showFile(this._fileState.getCurrent()))},k.prototype.setFiles=function(e,t){this._files.reset(e),this._fileState.setCurrentWithQuery(t),this.trigger("fv.setFiles"),this.isOpen()&&this.showFile(this._fileState.getCurrent())},k.prototype.getCurrent=function(){var e=this._view.getCurrentFile();return e&&e.toJSON()},k.prototype.getCurrentFile=function(){return this._view.getCurrentFile()},k.prototype.getFiles=function(){return this._files.toJSON()},k.prototype.isShowingFirstFile=function(){return 0===this._fileState.attributes.currentFileIndex},k.prototype.isShowingLastFile=function(){return this._fileState.collection.length===this._fileState.attributes.currentFileIndex+1},k.prototype.changeMode=function(e){this._view.setupMode(e),this.trigger("fv.changeMode",e)},k.prototype.getMode=function(){return this._view.getMode()},k.prototype.isInMode=function(e){return this._view.isInMode(e)},k.prototype.addFileAction=function(e){r(e.key,"has key"),r(e.text,"has text"),r(e.callback,"has a callback"),this._view.fileControlsView.getLayerForName("moreButton").addFileAction(e)},k.prototype.removeFileAction=function(e){r(e.key,"has key"),this._view.fileControlsView.getLayerForName("moreButton").removeFileAction(e)},k.prototype.supports=function(e){var t=this._viewerRegistry.get(e);return t&&t!==S},k.prototype.set=function(e,t){this._properties.set(e,t)},k.prototype.get=function(e){return this._properties.get(e)},k.prototype.getConfig=function(){return this._config},k.prototype.getView=function(){return this._view},k.prototype.getStorage=function(){return this._storage},k.prototype.showFile=function(e){return this._showFile(e)},k.prototype.showFileWithCID=function(e){return this._fileState.setCurrentWithCID(e),this.showFile(this._fileState.getCurrent())},k.prototype.showFileWithId=function(e,t){var i={id:e};return t&&(i.ownerId=t),this.showFileWithQuery(i)},k.prototype.showFileWithSrc=function(e){var t={src:e};return this.showFileWithQuery(t)},k.prototype.showFileWhere=function(e){return this._fileState.selectWhere(e),this.showFile(this._fileState.getCurrent())},k.prototype.updateFiles=function(e,t){if(t&&o.isFunction(t)){var i=o.chain(e).map(function(e){var i=this._files.find(function(i){return t(i.toJSON())===t(e)});return i?void i.set(e):new u(e)}.bind(this)).compact().value();this._files.add(i,{silent:!0}),this._files.trigger("reset",this._files)}else this._files.reset(e);return this.trigger("fv.updateFiles"),this._files.toJSON()},k.prototype._showFile=function(e){r(this._isOpen,"FileViewer is open");var t=function(t){return function(){this.trigger(t,e)}.bind(this)}.bind(this);return this.trigger("fv.changeFile",e),this._view.showFile(e).done(t("fv.showFile")).fail(t("fv.showFileError"))},k}),t("file",["backbone"],function(e){
  var t=e.Model.extend({defaults:{src:"",type:"",thumbnail:"",poster:"",title:"",downloadable:!0}});return t}),t("files",["backbone","underscore","file"],function(e,t,i){var n=e.Collection.extend({model:i,getIndexWithCID:function(e){return this.indexOf(this.get({cid:e}))}});return n}),t("focus-manager",["assert"],function(e){var t=function(e){return e&&e.hasAttribute?e.hasAttribute("data-fv-allow-focus")||t(e.parentElement):!1},i=function(t){e(t,"the first parameter to new FocusManager is a jQuery element"),this.$container=t,this._handler=this._focusHandler.bind(this)};return i.prototype.trapFocus=function(){this._unfocusParentPage(),document.addEventListener("focus",this._handler,!0)},i.prototype.releaseFocus=function(){document.removeEventListener("focus",this._handler,!0),this._restoreFocus()},i.prototype._focusHandler=function(e){t(e.target)||!this.$container||this.$container[0].contains(e.target)||(e.stopPropagation(),document.activeElement.blur(),this.$container.attr("tabindex",1),this.$container.focus())},i.prototype._unfocusParentPage=function(){this._originalActiveElement=document.activeElement,this._originalActiveElement.blur(),this.$container.attr("tabindex",1),this.$container.focus()},i.prototype._restoreFocus=function(){this._originalActiveElement&&this._originalActiveElement.focus()},i}),t("icon-utils",["file-types"],function(e){var t={getCssClass:function(t){var i="cp-unknown-file-type-icon";return e.isImage(t)?i="cp-image-icon":e.isPDF(t)?i="cp-pdf-icon":e.isWordProcessing(t)?i="cp-document-icon":e.isSpreadsheet(t)?i="cp-spreadsheet-icon":e.isPresentation(t)?i="cp-presentation-icon":e.isText(t)?i="cp-text-icon":e.isCode(t)?i="cp-code-icon":e.isMultimedia(t)?i="cp-multimedia-icon":e.isArchive(t)&&(i="cp-archive-icon"),i}};return t}),t("image-view-provider",["jquery","file"],function(e,t){var n=function(){return e.Deferred().resolve(i("image-view"))};return n}),t("instance-manager",["jquery"],function(e){var t=function(e,t){this._createFn=e,this._destroyFn=t,this._instance=null,this._destroyDeferred=null};return t.prototype.create=function(){var t=arguments,i=new e.Deferred,n=this._destroyDeferred&&this._destroyDeferred.promise()||e.when();return n.then(function(){this._destroyDeferred=new e.Deferred,this._instance=this._createFn.apply(this._createFn,t),i.resolve(this._instance)}.bind(this)),i.promise()},t.prototype.destroy=function(){this._destroyDeferred&&(this._destroyFn(this._instance),this._destroyDeferred.resolve())},t}),t("keys",[],function(){return{F:70,G:71,P:80,RETURN:13,ESCAPE:27,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,PLUS:187,MINUS:189,PLUS_NUMPAD:107,MINUS_NUMPAD:109,PLUS_FF:61,MINUS_FF:173,SPACE:32,ENTER:13,TAB:9}}),t("layer-container-view",["underscore","backbone","assert","constants-dictionary"],function(e,t,i,n){var o=function(e){return e()},s=function(e,t){return t[e]},r=function(t,i){return e.isFunction(i[t])&&i[t].bind(i)},a=t.View.extend({initialize:function(e){this._layerViewsByName=new n,this._layerViewRegistrations=[],this._layers=null,this._fileViewer=e.fileViewer},hasLayerView:function(e){return this._layerViewsByName.isDefined(e)},addLayerView:function(t,n,o){i(!this.hasLayerView(t),"name is unique"),o=e.extend({predicate:function(){return!0},weight:0},o),this._layerViewsByName.define(t,n),this._layerViewRegistrations.push({LayerView:n,name:t,predicate:o.predicate,weight:o.weight})},areLayersInitialized:function(){return null!==this._layers},countInitializedLayers:function(){return(this._layers||[]).length},initializeLayers:function(){this.initializeLayerSubset(e.map(this._layerViewRegistrations,"name"))},initializeLayerSubset:function(t){i(!this.areLayersInitialized(),"layers are uninitialized"),this._layers=this._layerViewRegistrations.filter(function(e){var i=-1!==t.indexOf(e.name);return i&&e.predicate(this._fileViewer)},this).map(function(e){var t=new e.LayerView({contentLayerView:this,fileViewer:this._fileViewer});return{view:t,name:e.name,weight:e.weight}},this),this._layers=e.sortBy(this._layers,function(e){return-1*e.weight}),this.trigger("initializeLayers"),this.render()},teardownLayers:function(){this.areLayersInitialized()&&(this._layers.map(e.partial(s,"view")).map(e.partial(r,"teardown")).filter(e.isFunction).forEach(o),this._layers.map(e.partial(s,"view")).map(e.partial(r,"remove")).filter(e.isFunction).forEach(o),this._layers=null),this.trigger("teardownLayers"),this.render()},reinitializeLayers:function(){this.teardownLayers(),this.initializeLayers()},isLayerInitialized:function(t){return this.areLayersInitialized()&&e.find(this._layers,function(e){return e.name===t})?!0:!1},getLayerForName:function(t){i(this.areLayersInitialized(),"layers are initialized"),i(this.hasLayerView(t),"layer is defined");var n=e.find(this._layers,function(e){return e.name===t});return i(n,"layer is initialized"),n.view},render:function(){return this.$el.empty(),this.areLayersInitialized()&&(this._layers.map(e.partial(s,"view")).map(e.partial(r,"render")).forEach(o),this._layers.map(e.partial(s,"view")).map(e.partial(s,"$el")).forEach(function(e){this.$el.append(e)},this)),this.trigger("renderLayers"),this}});return a}),t("MainView",["ajs","backbone","underscore","jquery","focus-manager","files","file","TitleView","DownloadButton","CloseButton","MoreButton","ViewerLayer","panel-container-view","layer-container-view","ErrorLayer","WaitingLayer","PasswordLayer","ArrowLayer","ToolbarLayer","SpinnerLayer","template-store-singleton","keys","baseMode","presentationMode","Commands"],function(e,t,i,n,o,s,r,a,l,c,d,u,h,p,f,w,g,m,v,y,_,b,V,S,F){var T=function(e){return(new n.Deferred).reject(new Error(e)).promise()},k=t.View.extend({id:"cp-container",initialize:function(e){var t=i.extend({},e);this._fileViewer=t.fileViewer,this._currentFile=null,this._viewState=null,this._focusManager=new o(this.$el),this.$el.attr({role:"dialog","aria-labelledby":"cp-title-container"}),this.fileTitleView=new h({fileViewer:this._fileViewer,id:"cp-title-container",className:"aui-item"}),this.fileControlsView=new p({fileViewer:this._fileViewer,id:"cp-file-controls",className:"aui-item"}),this.fileMetaView=new p({fileViewer:this._fileViewer,id:"cp-meta"}),this.fileSinkView=new h({id:"cp-sink",collection:this._fileViewer._fileState.collection,fileViewer:this._fileViewer}),this.fileSidebarView=new h({id:"cp-sidebar",fileViewer:this._fileViewer,collection:this._fileViewer._fileState.collection}),this.fileContentView=new p({id:"cp-file-body",fileViewer:this._fileViewer}),this.fileTitleView.addPanelView("title",a),this.fileControlsView.addLayerView("downloadButton",l,{weight:10,predicate:l.isDownloadable}),this.fileControlsView.addLayerView("moreButton",d),this.fileControlsView.addLayerView("closeButton",c),this.fileContentView.addLayerView("content",u),this.fileContentView.addLayerView("error",f),this.fileContentView.addLayerView("password",g),this.fileContentView.addLayerView("toolbar",v),this.fileContentView.addLayerView("waiting",w),this.fileContentView.addLayerView("spinner",y),this.fileContentView.addLayerView("arrows",m),this.listenTo(this.fileSidebarView,"togglePanel",this._updateContentWidth),this.listenTo(this.fileSinkView,"togglePanel",this._updateContentHeight),this._navigationKeyLockCount=0,this._showFileChain=n.when(),this._mode="BASE",this._modes={BASE:V,PRESENTATION:S},this._fixTooltipCleanup()},show:function(){return this.$el.show(),n("body").addClass("no-scroll"),this.$el.on("mouseup mousedown","a",function(e){this.blur()}),this.$el.on("mouseup mousedown","button",function(e){this.blur()}),n(document).on("keydown.disableDefaultKeys",this._disableKeyboardShortcuts.bind(this)),n(document).on("keydown.navKeys",this._handleNavigationKeys.bind(this)),this},hide:function(){return this.$el.hide(),n("body").removeClass("no-scroll"),n(document).off("keydown.disableDefaultKeys"),n(document).off("keydown.navKeys"),n(document).off("keydown.modeKeys"),this._deactivateModeHook(),this._modes[this._mode].teardown(this),this._teardownAll(),this},render:function(){return this.$el.empty().append(_.get("fileView")()),this.$header=this.$("#cp-header"),this.$body=this.$("#cp-body"),this.$footer=this.$("#cp-footer"),this.$title=this.fileTitleView.render().$el.appendTo(this.$header),this.$controls=this.fileControlsView.render().$el.appendTo(this.$header),this.$content=this.fileContentView.render().$el.appendTo(this.$body),this.$sidebar=this.fileSidebarView.render().$el.appendTo(this.$body),this.$meta=this.fileMetaView.render().$el.appendTo(this.$footer),this.$sink=this.fileSinkView.render().$el.appendTo(this.$footer),this.$el.on("click","a[href='#']",function(e){e.preventDefault()}),this._focusManager.trapFocus(),this},showFile:function(t){var i=!this.fileContentView.isLayerInitialized("content")||k._needsToRerenderContent(this._currentFile,t);if(k._filesWillRenderTheSame(this._currentFile,t))return k._skipRenderingOf(t);var o,s,a,l,c,d=new F.LookupViewer(t,this._fileViewer._viewerRegistry);this.trigger("cancelShow");var u=new n.Deferred;return this._showFileChain.pipe(function(){var h=new n.Deferred,p=n.when().pipe(function(){this._currentFile=t,this._viewState=null;var r;return t?(i?(this.trigger("fv.fileChange",t),this._reinitializeAllSubviews()):this._reinitializeNonContentSubviews(),o=this.fileContentView.getLayerForName("content"),s=this.fileContentView.getLayerForName("toolbar"),a=this.fileContentView.getLayerForName("spinner"),l=this.fileContentView.getLayerForName("waiting")):(this._viewState="fileNotFound",this._reinitializeCoreSubviews(),r=T(e.I18n.getText("cp.error.file.not.found"))),c=this.fileContentView.getLayerForName("error"),this._deactivateModeHook(),this._activateModeHook(),this&&this._fileViewer&&this._fileViewer.lastFocusId&&n("#"+this._fileViewer.lastFocusId).focus(),r}.bind(this));return i&&(p=p.pipe(function(){var i=this._fileViewer.getConfig().isPreviewGenerated,o=this._fileViewer.getConfig().generatePreview;return a.startSpin(),this._fileViewer.supports(t.get("type"))?n.when(t.get("src"),t.get("type")):i&&o?i(t).pipe(function(i,s,r,c){return i?n.when(s,r,c):(a.stopSpin(),l.showMessage(t,e.I18n.getText("cp.file.converting.message.header"),e.I18n.getText("cp.file.converting.message.text")),o(t).always(function(){l.clearMessage(),a.startSpin()}))}):n.when(t.get("src"),t.get("type"))}.bind(this)).pipe(d.execute.bind(d)).pipe(function(e,i,a){var l=new n.Deferred,c=new e({previewSrc:i,model:new r(a.toJSON()),fileViewer:this._fileViewer});return c.once("viewerReady",function(){this._viewState="success",s.setViewer(c),this.setupMode(this._mode),l.resolve(t)}.bind(this)),c.once("viewerFail",function(e){this._viewState="viewerError",l.reject(e),this.setupMode(this._mode)}.bind(this)),o.attachViewer(c),c.render(),l.promise()}.bind(this)).always(function(){a&&a.stopSpin(),l&&l.clearMessage()}.bind(this)).fail(function(e){u.reject(e),"cancelled"!==e&&c.showErrorMessage(e,t)}.bind(this))),p.done(function(){u.resolve(t)}).always(function(){h.resolve()}.bind(this)),h.promise()}.bind(this)),u.promise()},getCurrentFile:function(){return this._currentFile},getViewState:function(){return this._viewState||"loading"},_reinitializeAllSubviews:function(){this.fileTitleView.isAnyPanelInitialized()||this.fileTitleView.initializePanel(),this.fileTitleView.reinitializePanel(),this.fileControlsView.reinitializeLayers(),this.fileContentView.reinitializeLayers(),this.fileSidebarView.reinitializePanel(),this.fileMetaView.reinitializeLayers(),this.fileSinkView.reinitializePanel(),this._updateMetaBannerHeight()},_reinitializeNonContentSubviews:function(){this.fileTitleView.isAnyPanelInitialized()||this.fileTitleView.initializePanel(),this.fileTitleView.reinitializePanel(),this.fileControlsView.reinitializeLayers(),this.fileSidebarView.reinitializePanel(),this.fileMetaView.reinitializeLayers(),this.fileSinkView.reinitializePanel(),this._updateMetaBannerHeight()},_reinitializeCoreSubviews:function(){this._teardownAll(),this.fileControlsView.initializeLayerSubset(["closeButton"]),this.fileContentView.initializeLayerSubset(["arrows","error"])},_teardownAll:function(){this.fileTitleView.teardownPanel(),this.fileSidebarView.teardownPanel(),this.fileSinkView.teardownPanel(),this.fileMetaView.teardownLayers(),this.fileControlsView.teardownLayers(),this.fileContentView.teardownLayers(),this._focusManager.releaseFocus()},_handleNavigationKeys:function(e){var t=this._fileViewer._files.length,i=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;e.which!==b.ESCAPE||this.isNavigationLocked()?!i&&!this.isNavigationLocked()&&t>1&&e.which===b.ARROW_RIGHT?(e.preventDefault(),this._fileViewer.showFileNext().always(this._fileViewer.analytics.fn("files.fileviewer-web.next",{actionType:"hotkey",mode:this._fileViewer.getMode()}))):!i&&!this.isNavigationLocked()&&t>1&&e.which===b.ARROW_LEFT&&(e.preventDefault(),this._fileViewer.showFilePrev().always(this._fileViewer.analytics.fn("files.fileviewer-web.prev",{actionType:"hotkey",mode:this._fileViewer.getMode()}))):(e.preventDefault(),this._fileViewer.analytics.send("files.fileviewer-web.closed",{actionType:"hotkey"}),this._fileViewer.close())},lockNavigationKeys:function(){this._navigationKeyLockCount+=1},unlockNavigationKeys:function(){this._navigationKeyLockCount>=1&&(this._navigationKeyLockCount-=1)},isNavigationLocked:function(){return 0!==this._navigationKeyLockCount},_disableKeyboardShortcuts:function(e){if(e.ctrlKey||e.metaKey)switch(e.which){case b.F:case b.G:e.preventDefault();break;case b.P:e.preventDefault()}},_onClickToBackground:function(e){var t=this._fileViewer._view._modes[this._fileViewer._view._mode];if(!t.disableClickBackgroundCloses){var i=["cp-error-layer","cp-waiting-layer","cp-password-layer"];i.indexOf(e.target.className)>=0&&(this._fileViewer.analytics.send("files.fileviewer-web.closed",{actionType:"element"}),this._fileViewer.close())}},_updateContentWidth:function(e,t){this.$content&&this.$content.toggleClass("narrow",t),this._resizeActiveViewer()},_updateContentHeight:function(e,t){this.$content&&this.$content.toggleClass("short",t),this.$sidebar&&this.$sidebar.toggleClass("short",t),this._resizeActiveViewer()},_updateMetaBannerHeight:function(){var e=this.fileMetaView.countInitializedLayers()>0;this.fileContentView.$el.toggleClass("meta-banner",e),this.fileSidebarView.$el.toggleClass("meta-banner",e)},_resizeActiveViewer:function(){if(this.fileContentView.isLayerInitialized("content")){var e=this.fileContentView.getLayerForName("content"),t=e.getAttachedViewer();t&&t.handleResize()}},_fixTooltipCleanup:function(){var e=function(){n(".tipsy").remove()};this._fileViewer.on("fv.changeFile",e),this._fileViewer.on("fv.close",e)},getMode:function(){return this._mode||""},isInMode:function(e){return this._mode===e},setupMode:function(e){var t=this.fileContentView.getLayerForName("toolbar"),i=t._viewer,o=this.fileContentView.getLayerForName("arrows").$el,s=this._mode,r=s!==e,a=this._modes[e],l=this._modes[s];r?(this._deactivateModeHook(),this._mode=e,this._activateModeHook()):this._mode=e,n(document).off("keydown.modeKeys"),l.teardown(this,i,r),a.setup(this,i),o.toggle(a.showsArrowLayer),t.setActions(a.toolbarActions),t.render(),i&&i.setupMode&&i.setupMode(e,r)},_activateModeHook:function(){var e=this._modes[this._mode];e.activateHook&&e.activateHook(this)},_deactivateModeHook:function(){var e=this._modes[this._mode];e.deactivateHook&&e.deactivateHook(this)},updatePaginationButtons:function(){if(this.isInMode("PRESENTATION")){var e=this.fileContentView.getLayerForName("toolbar");if(!e._viewer)return;var t=e.$el.find(".cp-toolbar-prev-page"),i=e.$el.find(".cp-toolbar-next-page");t.toggleClass("inactive",!1),i.toggleClass("inactive",!1),e._viewer.hasPreviousPage()||e._viewer.hasNextPage()?e._viewer.hasPreviousPage()?e._viewer.hasNextPage()||i.toggleClass("inactive",!0):t.toggleClass("inactive",!0):(t.hide(),i.hide())}}});return k._filesWillRenderTheSame=function(e,t){return e&&t?i.isEqual(e.attributes,t.attributes):!1},k._needsToRerenderContent=function(e,t){if(!e||!t)return!0;var i=e.get("type")!==t.get("type"),n=e.get("src")!==t.get("src"),o=e.get("thumbnail")!==t.get("thumbnail");return i||n||o},k._skipRenderingOf=function(e){return n.when(e)},k}),t("module-store-singleton",["module-store"],function(e){return new e}),t("module-store",["assert","jquery","underscore"],function(e,t,i){var n=function(){this._backend=null};return n.validBackend=function(e){return i.isFunction(e)},n.prototype.get=function(i){return e(n.validBackend(this._backend),"backend is valid"),t.when(this._backend(i))},n.prototype.useBackend=function(t){e(n.validBackend(t),"backend is valid"),this._backend=t},n}),t("MoreButton",["jquery","underscore","backbone","template-store-singleton"],function(e,t,i,n){var o=i.View.extend({tagName:"span",initialize:function(e){this._fileViewer=e.fileViewer,this._fileActions=[]},render:function(){this.$el.html(n.get("moreButton")());var t=this.$el.find("#cp-more-menu"),i=t.find("ul");t.on({"aui-dropdown2-show":function(){this.$("button").tipsy("disable")}.bind(this),"aui-dropdown2-hide":function(){this.$("button").tipsy("enable")}.bind(this)});var o=this._fileViewer._fileState.getCurrent();return this.$("button").tooltip({gravity:"n"}),this._fileActions.length?(this._fileActions.forEach(function(t){var s=e(n.get("moreMenuItem")({text:t.text}));s.click(function(e){e.preventDefault(),t.callback(o)}),i.append(s)}),this._show()):this._hide(),this},addFileAction:function(e){var i=t.findWhere(this._fileActions,{key:e.key});i?t.extend(i,{key:e.key,text:e.text,callback:e.callback}):this._fileActions.push({key:e.key,text:e.text,callback:e.callback}),this.render()},removeFileAction:function(e){var i=t.indexOf(this._fileActions,e);this._fileActions.splice(i,1),this.render()},_show:function(){this.$el.css("display","inline")},_hide:function(){this.$el.css("display","none")}});return o}),t("panel-container-view",["backbone","assert","constants-dictionary"],function(e,t,i){var n=e.View.extend({className:"panel-view",initialize:function(e){this._panelViewsByName=new i,this._currentPanel=null,this._currentPanelName=null,this._lastAddedPanelName=null,this._fileViewer=e.fileViewer},hasPanelView:function(e){return this._panelViewsByName.isDefined(e)},addPanelView:function(e,t){this._panelViewsByName.define(e,t),this._lastAddedPanelName=e},isAnyPanelInitialized:function(){return this.$el.is(".expanded")},isPanelInitialized:function(e){return this._currentPanelName===e},initializePanel:function(e){e=e||this._lastAddedPanelName,t(this.isAnyPanelInitialized()===!1,"no panel is initialized"),t(this.hasPanelView(e)===!0,"panel exists");var i=this._panelViewsByName.lookup(e);this._currentPanelName=e,this._currentPanel=new i({collection:this.collection,fileViewer:this._fileViewer,panelView:this}),this.$el.toggleClass("expanded",!0),this.trigger("initializePanel",this._currentPanelName),this.trigger("togglePanel",this._currentPanelName,!0),this.render()},teardownPanel:function(){this._currentPanel&&(this._currentPanel.teardown&&this._currentPanel.teardown(),this._currentPanel.remove()),this.$el.toggleClass("expanded",!1),this.trigger("togglePanel",this._currentPanelName,!1),this.trigger("teardownPanel",this._currentPanelName),this._currentPanelName=null,this._currentPanel=null,this.render()},reinitializePanel:function(){if(this.isAnyPanelInitialized()){var e=this.getInitializedPanelName();this.teardownPanel(),this.initializePanel(e)}},getInitializedPanelName:function(){return t(this.isAnyPanelInitialized(),"a panel is initialized"),this._currentPanelName},getInitializedPanel:function(){return this._currentPanel},render:function(){return this.$el.empty(),this.isAnyPanelInitialized()&&(this._currentPanel.render(),this._currentPanel.$el.appendTo(this.$el)),this.trigger("renderPanel",this._currentPanelName),this}});return n}),t("PasswordLayer",["ajs","backbone","jquery","keys","template-store-singleton"],function(e,t,i,n,o){var s={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},r=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"].join(" "),a=function(){return document.fullscreenElement||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement},l=t.View.extend({className:"cp-password-layer",events:{"keydown .cp-password-input":"_handleKeyDown","click .cp-password-button":"_handleClick","focus .cp-password-input":"_lockNavigation","blur .cp-password-input":"_unlockNavigation"},initialize:function(e){this._fileViewer=e.fileViewer,this.$el.hide()},teardown:function(){i(document).off(r,this.updatePasswordLayer.bind(this))},showPasswordInput:function(e,t){i(document).on(r,this.updatePasswordLayer.bind(this)),this.updatePassword=t,this._fileViewer._view.fileContentView.getLayerForName("spinner").stopSpin(),this.$el.show().html(o.get("passwordLayer")({prompt:this._getPromptTitle(e)})),this.updatePasswordLayer(),this._showToolbar()},hidePasswordInput:function(){i(document).off(r,this.updatePasswordLayer.bind(this)),this.$el.empty(),this.$el.hide()},updatePasswordLayer:function(){a()?(this.$el.find(".cp-password-base").hide(),this.$el.find(".cp-password-fullscreen").show()):(this.$el.find(".cp-password-fullscreen").hide(),this.$el.find(".cp-password-base").show())},_getPromptTitle:function(t){var i=e.I18n.getText("cp.password.needed");return t===s.INCORRECT_PASSWORD&&(i=e.I18n.getText("cp.password.incorrect")),i},_showToolbar:function(){var e=this._fileViewer._view,t=e.fileContentView.getLayerForName("toolbar"),i=e._modes[e._mode];t.setActions(i.toolbarActions),t.render()},_updatePassword:function(){var e=this.$el.find(".cp-password-input").val();e&&e.length>0&&(this.hidePasswordInput(),this.updatePassword(e))},_lockNavigation:function(){this._fileViewer._view._navigationKeyLockCount++},_unlockNavigation:function(){this._fileViewer._view._navigationKeyLockCount--},_handleClick:function(e){e.preventDefault(),this._updatePassword()},_handleKeyDown:function(e){return e.which===n.RETURN?(e.preventDefault(),this._updatePassword()):e.which===n.ESCAPE?(e.preventDefault(),this._fileViewer.close()):void 0}});return l}),t("pdf-view-provider",["jquery","file","module-store-singleton"],function(e,t,n){var o=null,s=null,r=function(){o||(o=n.get("pdf-viewer")),s||(s=n.get("pdf-config"));var t=e.Deferred();return e.when(o,s).done(function(e,n){var o=i("pdf-view");PDFJS.workerSrc=n.workerSrc,PDFJS.cMapUrl=n.cMapUrl,t.resolve(o)}),t.promise()};return r}),t("presentationMode",["jquery","keys"],function(e,t){var i=function(){var t=e("#cp-file-body")[0];t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()},n=function(){document.cancelFullscreen?document.cancelFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},o=function(){return document.fullscreenElement||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement},s=function(e){o()||this.isInMode("BASE")||(this._fileViewer.analytics.send("files.fileviewer-web.presentation.exit",{actionType:"hotkey"}),this._fileViewer.changeMode("BASE"))},r={activateHook:function(t){e(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",s.bind(t));var i=t.fileContentView.getLayerForName("arrows").$el;i.toggle(this.showsArrowLayer)},deactivateHook:function(t){e(document).off("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",s.bind(t))},setup:function(t,n){this._originalScrollTop=e("body").scrollTop(),e("#cp-file-body").addClass("presentation"),e(document).on("keydown.modeKeys",this._handleKeys.bind(t)),o()||i()},teardown:function(t,i,s){e("#cp-file-body").removeClass("presentation"),e(document).off("keydown.modeKeys"),s&&o()&&n(),e("body").scrollTop(this._originalScrollTop)},disableClickBackgroundCloses:!0,showsArrowLayer:!1,_handleKeys:function(e){e.preventDefault();var i,n;if(this.fileContentView.isLayerInitialized("content")&&(i=this.fileContentView.getLayerForName("content"),n=i.getAttachedViewer()),n&&!e.ctrlKey&&!e.metaKey)switch(e.which){case t.ARROW_UP:return void(n.goToPreviousPage&&(this._fileViewer.analytics.send("files.fileviewer-web.presentation.pageprev",{actionType:"hotkey"}),n.goToPreviousPage(),this.updatePaginationButtons()));case t.ARROW_DOWN:return void(n.goToNextPage&&(this._fileViewer.analytics.send("files.fileviewer-web.presentation.pagenext",{actionType:"hotkey"}),n.goToNextPage(),this.updatePaginationButtons()))}},toolbarActions:[{title:AJS.I18n.getText("cp.go.to.prev.page"),className:"cp-toolbar-prev-page",predicate:function(){return this._viewer&&this._viewer.goToPreviousPage},handler:function(){this._viewer&&this._viewer.goToPreviousPage&&(this._fileViewer.analytics.send("files.fileviewer-web.presentation.pageprev",{actionType:"button"}),this._viewer.goToPreviousPage(),this._fileViewer.getView().updatePaginationButtons())}},{title:AJS.I18n.getText("cp.exit.presentation.mode"),className:"cp-toolbar-presentation-exit",handler:function(){this._fileViewer.analytics.send("files.fileviewer-web.presentation.exit",{actionType:"button"}),this._fileViewer.changeMode("BASE")}},{title:AJS.I18n.getText("cp.go.to.next.page"),className:"cp-toolbar-next-page",predicate:function(){return this._viewer&&this._viewer.goToNextPage},handler:function(){this._viewer&&this._viewer.goToNextPage&&(this._fileViewer.analytics.send("files.fileviewer-web.presentation.pagenext",{actionType:"button"}),this._viewer.goToNextPage(),this._fileViewer.getView().updatePaginationButtons())}}]};return r}),t("soy-template-backend",[],function(){var e=function(e,t){var i,n=t.split(".");for(i=0;i<n.length;i++)e=e[n[i]];return e};return function(t){return function(t){return e(n.Templates,t)}}}),t("SpinnerLayer",["backbone","template-store-singleton"],function(e,t){var i="large",n={color:"#fff",zIndex:"auto"},o=e.View.extend({className:"cp-spinner-layer",initialize:function(){this._updateElements()},render:function(){return this.$el.html(t.get("fileBodySpinner")()),this._updateElements(),this},startSpin:function(){this.$spinner.spin(i,n)},stopSpin:function(){this.$spinner.spin(!1)},_updateElements:function(){this.$spinner=this.$el.find(".cp-spinner")}});return o}),t("storage",["assert"],function(e){var t=function(e,t){this._namespace=t||"",this._storage=this._getStorage(e)};t.prototype.getItem=function(e){var t;return e=this._namespace+e.toString(),t=new i,t.fromJSON(this._storage.getItem(e)),t.isExpired()?void this._storage.removeItem(e):t.value},t.prototype.setItem=function(e,t,n){e=this._namespace+e.toString(),this._storage.setItem(e,new i(t,n).toJSON())},t.prototype.removeItem=function(e){e=this._namespace+e.toString(),this._storage.removeItem(e)},t.prototype._hasLocalStorage=function(){var e=this._namespace+"hasLocalStorage";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return!1}},t.prototype._getStorage=function(i){return i?(e("function"==typeof i.setItem,"Storage custom.setItem is a function"),e("function"==typeof i.getItem,"Storage custom.getItem is a function"),e("function"==typeof i.removeItem,"Storage custom.removeItem is a function"),i):this._hasLocalStorage()?t.localStorage:t.noStorage},t.noStorage={setItem:function(){},getItem:function(){},removeItem:function(){}},t.localStorage={setItem:function(e,t){window.localStorage.setItem(e,t)},getItem:function(e){return window.localStorage.getItem(e)},removeItem:function(e){window.localStorage.removeItem(e)}};var i=t.StorageValue=function(e,t){this.value=e,this._setExpiry(t)};return i.prototype._setExpiry=function(e){parseInt(e)?this.expiry=Date.now()+e:this.expiry=null},i.prototype.isExpired=function(){return this.expiry&&Date.now()>this.expiry},i.prototype.fromJSON=function(e){var t;e=e||"{}",t=JSON.parse(e),this.value=t.value,this.expiry=t.expiry},i.prototype.toJSON=function(){return JSON.stringify({value:this.value,expiry:this.expiry||void 0})},t}),t("template-store-singleton",["template-store"],function(e){return new e}),t("template-store",["assert","underscore"],function(e,t){var i=function(){this._backend=null};return i.validBackend=function(e){return t.isFunction(e)},i.prototype.get=function(t){return e(i.validBackend(this._backend),"backend is valid"),this._backend(t)},i.prototype.useBackend=function(t){e(i.validBackend(t),"backend is valid"),this._backend=t},i}),t("TitleView",["backbone","icon-utils","template-store-singleton"],function(e,t,i){var n=e.View.extend({initialize:function(e){this._fileViewer=e.fileViewer},render:function(){var e=this._fileViewer.getCurrentFile();if(e)return this.$el.html(i.get("titleContainer")({title:e.get("title"),iconClass:t.getCssClass(e.get("type"))})),this}});return n}),t("ToolbarLayer",["jquery","underscore","backbone","template-store-singleton","keys"],function(e,t,i,n,o){var s=500,r=s-100,a=400,l=100,c=i.View.extend({className:"cp-toolbar-layer",initialize:function(t){this._fileViewer=t.fileViewer,this._viewer=null,this._toggleControlsTimeout=null,this._actions=[],e("#cp-file-body").on("mousemove.toolbarLayer",this._showControlsOnMove.bind(this)),e(document).on("keydown.tabToNavigate",this._tabToNavigate.bind(this))},teardown:function(){e(document).off("keydown.tabToNavigate"),e("#cp-file-body").off("mousemove.toolbarLayer")},render:function(){this.$el.html(n.get("toolbar")({actions:this._actions})),this.$el.find("button").tooltip({gravity:"s",aria:!0}),this.$toolbar=this.$(".cp-toolbar");var e={};return this._actions.forEach(function(t){e["click ."+t.className]=t.handler,t.predicate&&!t.predicate.call(this)&&this.$toolbar.find("."+t.className).hide()},this),this.delegateEvents(e),this.$toolbar.css("margin-left",-this.$toolbar.width()/2),this.$toolbar.on("click","a[href='#']",function(e){e.preventDefault()}),this},setActions:function(e){this._actions=e},setViewer:function(e){this._viewer=e,this.render()},_tabToNavigate:function(e){e.which===o.TAB&&this._showControlsOnMove.call(this)},_showControlsOnMove:t.throttle(function(){this.$toolbar&&(this.$toolbar.fadeTo(l,1),clearTimeout(this._toggleControlsTimeout),this._toggleControlsTimeout=this._setHideTimer())},r),_setHideTimer:function(){return setTimeout(function(){this.$toolbar.is(":hover")||this.$toolbar.has(":focus").length||(this.$toolbar.find("button").each(this._removeTooltipForElement),this.$toolbar.fadeTo(a,0))}.bind(this),s)},_removeTooltipForElement:function(t,i){var n=e(i).attr("aria-describedby");n&&e("#"+n).fadeOut()}});return c}),t("unknown-file-type-view-provider",["jquery","unknown-file-type-view"],function(e,t){var i=function(){return e.Deferred().resolve(t)};return i}),t("unknown-file-type-view",["ajs","BaseViewer","template-store-singleton","icon-utils","jquery"],function(e,t,i,n,o){var s=t.extend({id:"cp-unknown-file-type-view-wrapper",events:{"click .download-button":"_handleDownloadButton"},initialize:function(){t.prototype.initialize.apply(this,arguments)},teardown:function(){this.off(),this.remove()},render:function(){this.$el.html(i.get("unknownFileTypeViewer")({iconClass:n.getCssClass(this.model.get("type")),src:this.model.get("srcDownload")||this.model.get("src")}));var e=this._fileViewer.getView();return e.fileSidebarView.isAnyPanelInitialized()&&e.fileSidebarView.teardownPanel(),this.trigger("viewerReady"),this},setupMode:function(e){"BASE"===e&&o(".cp-toolbar-layer").hide()},_handleDownloadButton:function(e){this._fileViewer.trigger("fv.download",e),this._triggerAnalytics()},_triggerAnalytics:function(){this._fileViewer.analytics.send("files.fileviewer-web.file.download",{actionType:"cta"})}});return s}),t("url",[],function(){return{addQueryParamToUrl:function(e,t){t=t||{},e=e.split("?");var i=e[1]&&e[1].split("&");return i=i||[],Object.keys(t).forEach(function(e,n){i.push(e+"="+t[e])}),0===i.length?e[0]:e[0]+"?"+i.join("&")}}}),t("video-view-provider",["jquery","file"],function(e,t){
  var n=function(){return e.Deferred().resolve(i("video-view"))};return n}),t("viewer-registry",["underscore","assert"],function(e,t){var i=function(e){return function(t){return t===e}},n=function(){this._handlers=[]};return n.isValidPreviewer=function(t){return e.isFunction(t)},n.isValidWeight=function(e){return"number"==typeof e&&!isNaN(e)},n.prototype.register=function(e,o,s){var r="function"==typeof e?e:i(e);s=s||10,t(n.isValidPreviewer(o),"previewer is valid"),t(n.isValidWeight(s),"weight is valid"),this._handlers.push({matchesFileType:r,previewer:o,weight:s}),this._updateWeighting()},n.prototype.get=function(t){var i=e.find(this._handlers,function(e){return e.matchesFileType(t)});return i&&i.previewer},n.prototype._updateWeighting=function(){this._handlers=e.sortBy(this._handlers,function(e){return e.weight})},n}),t("ViewerLayer",["backbone"],function(e){var t=e.View.extend({className:"cp-viewer-layer",initialize:function(e){this._viewer=null},attachViewer:function(e){this._viewer=e,this.$el.prepend(e.$el)},getAttachedViewer:function(){return this._viewer},teardown:function(){this._viewer&&(this._viewer.teardown&&this._viewer.teardown(),this._viewer.$el.remove())}});return t}),t("WaitingLayer",["BaseViewer","template-store-singleton"],function(e,t){var i=e.extend({className:"cp-waiting-layer",events:{"click .download-button":"_handleDownloadButton"},initialize:function(){this.$el.hide(),e.prototype.initialize.apply(this,arguments)},showMessage:function(e,i,n){this.$el.show().html(t.get("waitingMessage")({src:e.get("srcDownload")||e.get("src"),header:i,message:n})),this.$el.find(".cp-waiting-message-spinner").spin("large",{color:"#fff",zIndex:"auto"})},_handleDownloadButton:function(e){this._fileViewer.trigger("fv.download",e)},clearMessage:function(){this.$el.find(".cp-waiting-message-spinner").spin(!1),this.$el.hide()}});return i});var n=i("file-viewer");n.Templates=window.FileViewer.Templates,"undefined"!=typeof module&&module.exports&&(module.exports=n),window.define&&window.define("FileViewer",["jquery","underscore","backbone","ajs"],function(){return n}),window.FileViewer=n}(),function(e){"use strict";var t=e.define;e.require;t("image-view",["ajs","backbone","underscore","jquery","file","BaseViewer","template-store-singleton"],function(e,t,i,n,o,s,r){var a=s.extend({id:"cp-image-preview",tagName:"div",initialize:function(){s.prototype.initialize.apply(this,arguments),this.bindPanEvents(),this.PIXELATE_THRESHOLD=2,this.MIN_HEIGHT=100,this.ZOOM_IN_FACTOR=1.25,this.ZOOM_OUT_FACTOR=.8,this._isFitWidth=!1,this._isFitHeight=!1},renderAnnotations:function(e){var t=this._fileViewer.getCurrentFile(),i=t.get("annotations");t&&e&&(this.pinsView=new e({fileViewer:this._fileViewer,container:this.$el.find(".cp-image-container"),collection:i}),this.pinsView.render()),i.on("selected",function(e){var t,i,n;e&&(t=this.$el.find("span.cp-active-annotation.selected"),t.length&&(i=t.position().top-this.$el.height()/2,n=t.position().left-this.$el.width()/2,this.$el.animate({scrollTop:i,scrollLeft:n})))}.bind(this))},bindPanEvents:function(){var e={x:0,y:0},t=this,i=function(i){var n=t.$el;n.scrollLeft(n.scrollLeft()+e.x-i.clientX),n.scrollTop(n.scrollTop()+e.y-i.clientY),e={x:i.clientX,y:i.clientY},i.preventDefault()},o=function(e){t.$el.off("mousemove","#cp-img",i),t.$image.removeClass("panning"),e.preventDefault()},s=function(s){n(window).one("mouseup",o),t.$el.on("mousemove","#cp-img",i),t.$image.addClass("panning"),e={x:s.clientX,y:s.clientY},s.preventDefault()};this.$el.on("mousedown","#cp-img",s)},handleResize:function(){this._forceRescale()},_forceRescale:function(){this._isFitHeight?this.zoomHeight():this._isFitWidth&&this.zoomWidth()},_fixContainerSize:function(){var e=this.$el.find(".cp-image-container"),t=this.$el.find("#cp-img");e.width(t.width()),e.height(t.height())},_isImageBiggerThanViewport:function(){return this._isImageWiderThanViewport()||this._isImageHigherThanViewport()},_isImageWiderThanViewport:function(){var e=this.$el.width();return this.imageWidth>e},_isImageHigherThanViewport:function(){var e=this.$el.height();return this.imageHeight>e},_isZoomedToPageFit:function(){return this.$el.width()===this.$image.width()||this.$el.height()===this.$image.height()},_stopFit:function(){this._isFitWidth=!1,this._isFitHeight=!1},_showScaleInfo:function(e){if(!this._rescaleForFullScreen){var t=Math.round(parseInt(100*e,10)),i=this.$el.find(".cp-scale-info");i.text(t+"%"),i.stop(!0,!0).fadeIn(50).delay(400).fadeOut(100)}},zoomIn:function(){var e=this.$image.width()/this.imageWidth*this.ZOOM_IN_FACTOR;this._stopFit(),this.changeScale(e)},zoomOut:function(){var e=this.$image.width()/this.imageWidth*this.ZOOM_OUT_FACTOR;this._stopFit(),this.changeScale(e)},zoomFit:function(){this._isZoomedToPageFit()?this.zoomActual():this.zoomAuto(!0)},zoomAuto:function(e){this._isImageBiggerThanViewport()||e?this._zoomPageFit():this.zoomActual()},_zoomPageFit:function(){var e=this.$el.width(),t=this.$el.height();e/this.imageWidth>t/this.imageHeight?this.zoomHeight():this.zoomWidth()},zoomWidth:function(){var e=this.$el.width(),t=e/this.imageWidth;this.changeScale(t),this._stopFit(),this._isFitWidth=!0},zoomHeight:function(){var e=this.$el.height(),t=e/this.imageHeight;this.changeScale(t),this._stopFit(),this._isFitHeight=!0},zoomActual:function(){this._stopFit(),this.changeScale(1)},changeScale:function(e){var t=this.$el.width(),i=this.$el.height(),n=this.$image.width(),o=this.$image.height(),s=this.$el.find(".cp-image-container").position(),r=t/2+Math.abs(s.left),a=i/2+Math.abs(s.top);this.$image.css("width",this.imageWidth*e),this.$image.css("height",this.imageHeight*e);var l=r/n*this.$image.width(),c=a/o*this.$image.height();this.$el.scrollLeft(l-t/2),this.$el.scrollTop(c-i/2),this.makePannable(),this.pixelateIfScaleOverThreshold(e),this._fixContainerSize(),this._showScaleInfo(e)},pixelateIfScaleOverThreshold:function(e){this.$image.toggleClass("pixelate",e>=this.PIXELATE_THRESHOLD)},makePannable:function(){this.$el.width()<this.$image.width()||this.$el.height()<this.$image.height()?this.$image.addClass("pannable"):this.$image.removeClass("pannable")},teardown:function(){s.prototype.teardown.apply(this),n(window).off("resize.cp-repaint"),this.pinsView&&this.pinsView.remove().off()},getBackground:function(){return this.$el.add(".cp-image-container")},render:function(){return this.$el.html(r.get("previewBody")()),this.addImage(),n(window).on("resize.cp-repaint",i.throttle(this._forceRescale.bind(this),250)),this},addImage:function(){var t=n("<img/>").attr("id","cp-img").attr("src",this._previewSrc).attr("alt",this.model.get("title"));t.off("load"),t.on("load",i.partial(this.scaleAndAppendImage,this)),t.on("load",function(){this.trigger("viewerReady")}.bind(this)),t.on("error",function(){var t=new Error("Image failed loading");t.title=e.I18n.getText("cp.error.image.missing.header"),t.description=this.model.get("src"),t.icon="cp-image-icon",this.trigger("viewerFail",t)}.bind(this)),t.on("click",function(){document.activeElement.blur()})},scaleAndAppendImage:function(e){var t=n(this);e.imageHeight=this.height,e.imageWidth=this.width,e.$image=t,t.css("display","none");var i=e.$el.find(".cp-image-container");i.append(e.$image),i.addClass("cp-annotatable"),e.zoomAuto(),e.$image.fadeIn(200),e.trigger("cp.imageAppended")},setupMode:function(e,t){t&&(clearInterval(this._fullScreenInProgress),this.scaleGraduallyToFit())},scaleGraduallyToFit:function(){var e=0;this._rescaleForFullScreen=!0,this._fullScreenInProgress=setInterval(function(){e++,11===e&&(clearInterval(this._fullScreenInProgress),this._rescaleForFullScreen=!1,this.zoomAuto()),this.zoomAuto()}.bind(this),100)}});return a})}(function(){var e;return e="undefined"!=typeof module&&"exports"in module?require("./fileviewer.js"):window.require?window.FileViewer:window.FileViewer}()),function(e){"use strict";var t=e.define,i=e.require;t("video-view/button-presentation-mode",[],function(){var e=videojs.Button.extend({init:function(e){this._fileViewer=e.fileViewer,this._player=e.player,videojs.Button.call(this,this._player,{el:videojs.Component.prototype.createEl(null,{className:"vjs-presentation-control vjs-control",innerHTML:['<div class="vjs-control-content">','<span class="vjs-control-text">',"Presentation Mode","</span>","</div>"].join(""),role:"button",tabindex:0,"aria-live":"polite"})}),this.on("click",this.changeMode)}});return e.asPlugin=function(t){return function(i){var n=this,o=new e({player:n,fileViewer:t});o.options=i,n.ready(function(){n.controlBar.addChild(o)})}},e.prototype.changeMode=function(){this._fileViewer.isInMode("PRESENTATION")?this._fileViewer.changeMode("BASE"):this._fileViewer.changeMode("PRESENTATION")},e}),t("video-view/button-toggle-hd",["template-store-singleton","jquery"],function(e,t){var i=videojs.Button.extend({init:function(t){this._fileViewer=t.fileViewer,this._player=t.player,this._isPlayingHd=t.isPlayingHd,videojs.Button.call(this,this._player,{el:videojs.Component.prototype.createEl(null,{className:"vjs-hd-control vjs-control",innerHTML:e.get("avPlayer.customControlBarItem")({descr:"Toggle HD/SD Quality"}),role:"button",tabindex:0,"aria-live":"polite"})}),this.on("click",this.toggleSource)}});return i.asPlugin=function(e){return function(n){if(n.src_hd){var o=this,s=new i({player:o,fileViewer:e,isPlayingHd:n.hd_active});s.options=n,o.ready(function(){t(this.el()).addClass("vjs-hd-source"),n.hd_active&&t(this.el()).addClass("vjs-hd-playing"),o.controlBar.addChild(s)})}}},i.prototype.fixPreload=function(){var e=this._player;"none"===e.el().firstChild.preload&&(e.el().firstChild.preload="metadata")},i.prototype.switchSource=function(e){var i=this._player,n=t(i.el()),o=i.paused(),s=n.hasClass("vjs-has-started");this.fixPreload(),n.find("source").remove(),i.poster(""),e.position&&t(i.tag).css("display","none"),i.src(e.src),i.ready(function(){i.one("loadedmetadata",function(){i.poster(e.poster),s&&n.addClass("vjs-has-started")}.bind(i)),e.position&&i.one("loadeddata",function(){i.currentTime(e.position),o?i.pause():i.play()}),i.one("seeked",function(){t(i.tag).css("display","block")})})},i.prototype.toggleSource=function(){var e=this._player,i=t(e.el()),n={position:e.tech.currentTime(),src:"",poster:""};this._isPlayingHd?(this._isPlayingHd=!1,this._fileViewer.getStorage().setItem("videoQualityHd",!1),n.src=this.options.src,n.poster=this.options.poster,i.removeClass("vjs-hd-playing")):(this._isPlayingHd=!0,this._fileViewer.getStorage().setItem("videoQualityHd",!0),n.src=this.options.src_hd,n.poster=this.options.poster_hd,i.addClass("vjs-hd-playing")),this.switchSource(n)},i}),t("video-view/button-youtube",["template-store-singleton","url"],function(e,t){var i=videojs.Button.extend({init:function(t){this._fileViewer=t.fileViewer,this._player=t.player,videojs.Button.call(this,this._player,{el:videojs.Component.prototype.createEl(null,{className:"vjs-youtube-control vjs-control",innerHTML:e.get("avPlayer.customControlBarItem")({descr:"Youtube"}),role:"button",tabindex:0,"aria-live":"polite"})}),this.on("click",this.openYoutubePage)}});return i.asPlugin=function(e){return function(t){var n=this,o=new i({player:n,fileViewer:e});n.ready(function(){n.controlBar.addChild(o)})}},i.prototype.openYoutubePage=function(){var e;this._fileViewer.analytics.send("files.fileviewer-web.file.gotoyoutube"),this._player.pause(),e=t.addQueryParamToUrl(this._player.src(),{start:Math.round(this._player.currentTime()),autoplay:1}),window.open(e,"_blank")},i}),t("video-view/plugin-progress-tooltips",["template-store-singleton","jquery"],function(e,t){var i=function(i){var n=this,o=function(){t("#vjs-tip").remove();var i=e.get("avPlayer.progressTooltip")();t(".vjs-progress-control").after(i),t(".vjs-progress-holder").on("mousemove",function(e){var i,o,s,r,a,l;r=n.controlBar.progressControl.seekBar,l=(e.pageX-t(r.el()).offset().left)/r.width(),a=l*n.duration(),a===n.duration()&&(a-=.1),o=Math.floor(a/60),s=Math.floor(a-60*o),10>s&&(s="0"+s),t("#vjs-tip-inner").text([o,":",s].join("")),i=t(".vjs-control-bar").height();var c=t(".vjs-control-bar"),d=t("#vjs-tip").outerWidth(),u=e.pageX-c.offset().left-Math.round(d/2);t("#vjs-tip").css("left",u+"px").css("display","block")}),t(".vjs-progress-holder, .vjs-play-control").on("mouseout",function(){t("#vjs-tip").css("display","none")})};this.on("loadedmetadata",o)};return i}),t("video-view",["ajs","backbone","underscore","jquery","file","BaseViewer","instance-manager","file-types","template-store-singleton","keys","video-view/button-youtube","video-view/button-toggle-hd","video-view/button-presentation-mode","video-view/plugin-progress-tooltips"],function(e,t,i,n,o,s,r,a,l,c,d,u,h,p){var f=new r(videojs,function(e){e.tech&&e.pause(),e.dispose()}),w=s.extend({id:"cp-video-preview",playerId:"cp-video-player",events:{"click .vjs-poster":"togglePlay"},initialize:function(){s.prototype.initialize.apply(this,arguments);var e=this.model.get("type");this._paddingVertical=20,this._paddingScrollbar=40,this._paddingNavArrows=160,this._isPaused=!0,this._isVideo=a.isVideo(e),this._isAudio=a.isAudio(e),this._isYoutube=a.isYoutube(e),this._isAutoPlay=this._fileViewer.get("videoViewerAutoplay"),this._maxWidth=this._isVideo?1280:640,this._maxHeight=this._isVideo?720:640,this._minWidth=this._isVideo?160:120,this._minHeight=this._isVideo?90:120,this._hasHdSource=this.model.get("src_hd")?!0:!1,n(window).on("resize.videojs",i.throttle(this._handleResize.bind(this),50)),n(document).on("keydown.videoView",this._handleKeyboardControl.bind(this))},teardown:function(){n(window).off("resize.videojs",this._handleResize),n(document).off("keydown.videoView"),f.destroy()},clickHitBackground:function(e){var t=e.target.getAttribute("id")===this.id;return t},setupMode:function(e){n(".cp-toolbar-layer").hide()},_handleKeyboardControl:function(e){(e.which===c.SPACE||e.which===c.ENTER)&&(this.togglePlay(),e.preventDefault())},render:function(){var e=this.model.get("type");return this.$el.html(l.get("avPlayer.playerBody")({src:this._getVideoSrc(),poster:this._getPosterSrc(),type:e,kind:this._isVideo?"video":"audio"})),f.create(this.playerId,{plugins:this._registerPlugins(),controls:!0,ytFullScreenControls:!1,textTrackDisplay:!1,errorDisplay:!1,controlBar:{timeDivider:!1,remainingTimeDisplay:!1,liveDisplay:!1,fullscreenToggle:!1,muteToggle:!1,volumeMenuButton:!1,playbackRateMenuButton:!0,subtitlesButton:!1,captionsButton:!1,chaptersButton:!1},autoplay:this._isAutoPlay,preload:!0,width:this._maxWidth,height:this._maxHeight}).then(this._setupPlayer.bind(this)),this},play:function(){this._videoPlayer.play()},togglePlay:function(){this._videoPlayer&&this._isPaused?this._videoPlayer.play():this._videoPlayer&&this._videoPlayer.pause()},_refocusFileViewer:function(){if("IFRAME"===document.activeElement.tagName){var e=n("#cp-container");e.attr("tabindex",-1),e.focus()}},handleResize:function(){this._handleResize()},_handleResize:function(){var e=Math.max(this.$el.width()-this._paddingNavArrows,this._minWidth),t=Math.max(this.$el.height()-this._paddingVertical,this._minHeight),i=n(this._videoPlayer.el()),o=i.width(),s=i.height(),r=Math.min(e/o,t/s),a=Math.min(this._maxWidth,o*r),l=Math.min(this._maxHeight,s*r);i.css("width",a).css("height",l)},_videoError:function(){var t=new Error("Media failed loading");t.title=e.I18n.getText("cp.error.media.default.header"),t.description=this.model.get("src"),t.icon="cp-multimedia-icon",this.viewerReady||(n("#"+this.playerId).remove(),this.trigger("viewerFail",t))},_videoLoadedMetaData:function(){n("#"+this.playerId).addClass("vjs-ready"),this.trigger("viewerReady"),this.viewerReady=!0},_videoVolumeChange:function(){var e=this._fileViewer.getStorage();e.setItem("videoVolume",this._videoPlayer.volume())},_videoPlay:function(){this._refocusFileViewer(),this._isPaused=!1,n(this._videoPlayer.el()).removeClass("vjs-has-ended")},_videoPause:function(){this._refocusFileViewer(),this._isPaused=!0},_videoEnded:function(){n(this._videoPlayer.el()).addClass("vjs-has-ended")},_restoreVolumeSetting:function(){var e=this._fileViewer.getStorage(),t=parseFloat(e.getItem("videoVolume"));isNaN(t)||this._videoPlayer.volume(t)},_restoreVideoPosterIfNotSet:function(){var e=this._videoPlayer.poster(),t=this._getPosterForCurrentQuality();this._isVideo&&!e&&this._videoPlayer.poster(t)},_handlePlayerReady:function(){this.viewerReady=!1,this._restoreVolumeSetting(),n(this._videoPlayer.el()).find(".vjs-control").each(function(e,t){n(t).removeAttr("tabindex")}),this._videoPlayer.one("timeupdate",this._restoreVideoPosterIfNotSet.bind(this)),this._videoPlayer.on("loadedmetadata",this._videoLoadedMetaData.bind(this)),this._videoPlayer.on("volumechange",this._videoVolumeChange.bind(this)),this._videoPlayer.on("error",this._videoError.bind(this)),this._videoPlayer.on("play",this._videoPlay.bind(this)),this._videoPlayer.on("pause",this._videoPause.bind(this)),this._videoPlayer.on("ended",this._videoEnded.bind(this))},_registerPlugins:function(){var e={};return videojs.plugin("pluginProgressTooltips",p),e.pluginProgressTooltips={},videojs.plugin("presentation",h.asPlugin(this._fileViewer)),e.presentation={viewer:this},videojs.plugin("buttonToggleHd",u.asPlugin(this._fileViewer)),e.buttonToggleHd={src:this.model.get("src"),src_hd:this.model.get("src_hd")||"",poster:this.model.get("poster")||"",poster_hd:this.model.get("poster_hd")||this.model.get("poster")||"",hd_active:this._shouldUseHdSource()},this._isYoutube&&(videojs.plugin("buttonYoutube",d.asPlugin(this._fileViewer)),e.buttonYoutube={}),e},_setUpAudio:function(e){e.addClass("vjs-audio"),this.model.get("poster")||e.find(".vjs-poster").addClass("vjs-default-coverart")},_setUpYoutube:function(e){n(".iframeblocker").css("display","none")},_setupPlayer:function(e){var t=n("#"+this.playerId);this._videoPlayer=e,this._handleResize(),this._isAudio&&this._setUpAudio(t),this._isYoutube&&this._setUpYoutube(t),e.ready(this._handlePlayerReady.bind(this))},_shouldUseHdSource:function(){if(!this._hasHdSource)return!1;var e=this._fileViewer.getConfig().videoDefaultQualityHd,t=this._fileViewer.getStorage().getItem("videoQualityHd"),i="undefined"==typeof t||t,n=(e&&i)!==!1;return this._hasHdSource&&n},_getPosterForCurrentQuality:function(){return this._shouldUseHdSource()?this.model.get("poster_hd")||this.model.get("poster")||"":this.model.get("poster")||""},_getPosterSrc:function(){return this._isAutoPlay&&this._isVideo?"":this._getPosterForCurrentQuality()},_getVideoSrc:function(){return this._shouldUseHdSource()?this.model.get("src_hd"):this.model.get("src")}});return w}),function(){var e=i("file-viewer");e.registerPlugin("autoplay-videos",function(e){var t;e.on("fv.open",function(){t=0}),e.on("fv.changeFile",function(){t++,e.set("videoViewerAutoplay",1===t)})})}()}(function(){var e;return e="undefined"!=typeof module&&"exports"in module?require("./fileviewer.js"):window.require?window.FileViewer:window.FileViewer}()),function(e){"use strict";var t=e.define,i=e.require;t("metabar/metabarPlugin",["metabar/metabarView"],function(e){var t=function(t){if(t.getConfig().metaBar){var i=t.getView(),n=i.fileMetaView;n.addLayerView("metabar",e,{predicate:e.predicate})}};return t}),t("metabar/metabarView",["underscore","backbone","template-store-singleton"],function(e,t,i){return t.View.extend({initialize:function(e){var t=e.fileViewer;this._meta=t.getCurrent().meta||{},this._config=t.getConfig().metaBar||{}},render:function(){this.$el.append(i.get("metabar")({avatarSrc:this._meta.avatarSrc||this._config.defaultAvatar,author:this._meta.author,authorPrefix:this._meta.authorPrefix,date:this._meta.date,time:this._meta.time,fileType:this._meta.fileType,fileSize:this._meta.fileSize})),this.$el.find(".cp-meta-avatar-image").one("error",e.partial(this._handleAvatarImageError,this))},_handleAvatarImageError:function(e){e._config.defaultAvatar?this.src=e._config.defaultAvatar:this.parentElement.remove()}},{predicate:function(e){var t=e.getConfig().metaBar,i=e.getCurrent().meta||{};return!!(t&&i.author&&i.date)}})}),function(){var e=i("file-viewer"),t=i("metabar/metabarPlugin");e.registerPlugin("metabar",t)}()}(function(){var e;return e="undefined"!=typeof module&&"exports"in module?require("./fileviewer.js"):window.require?window.FileViewer:window.FileViewer}());